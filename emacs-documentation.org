#+TITLE: Aide m√©moire emacs
#+BRAIN_PARENTS: Documentation
#+LANGUAGE: fr
#+OPTIONS: toc:true
#+DATE: 2020-04-21
#+AUTHOR: Pierre DEDIEU
#+Email: MangeChats@gmail.com
#+UID: emacs-doc-pde
## #+SETUPFILE: theme-bigblow-local.setup
#+SETUPFILE: theme-readtheorg-local.setup
#+Subject: Notes pour retrouver les raccourcis des fonctions que j'ai utilis√©es
#+PANDOC_OPTIONS: "epub-cover-image:3d-gnu-head.jpg" standalone:nil
#+roam_alias: emacs
:RESOURCES:
- Utilisation de GitLab avec [[magit][magit]]
- Prise de notes [[org-mode][Org]]
:END:

* Editeur
** Ouverture de fichiers
   - C-x f filename :: ouvrir un fichier en root
   - C-x f /sudo:: filename :: ouvrir un fichier en root
   - C-x f //scp:root@pde:/home/ :: TRAMP, ouvrir un fichier sur une autre
	machine via SSH: =/scp:root@hdvwww10.intranet.rouen.fr:/var/www/=.
	Noter qu'il peut √™tre inutile de pr√©ciser =scp:= qui est le
	protocole par d√©faut (identique √† =ssh:=).
   - helm-tramp :: tramp avec helm
     - il faut installer le package ~helm-tramp~
     - il est utile d'ajouter de la configuration dans l'init, pour
       avoir un raccourci d'ouverture de tels fichiers distants par
       exemple:
	#+BEGIN_SRC emacs-lisp
	  (setq tramp-default-method "ssh")
	  (define-key global-map (kbd "C-c s") 'helm-tramp)
	#+END_SRC
     - les choix en user courant et en root propos√©s sont trouv√©s √†
       partir des hosts d√©finis dans * ~/.ssh/config *
     - on peut faire de m√™me pour dired
     - lorsqu'on ouvre un eshell ou un shell depuis l'affichage d'un
       fichier/r√©pertoire tramp on a une ligne de commande vers le
       serveur corespondant, dans le dossier
   - C-x 4f :: ouvre un fichier dans une autre fen√™tre
   - C-x 52 :: Ouvre une autre frame (fen√™tre au sens de l'OS)
     - C-x 50 :: pour la fermer
     - C-x 51 :: pour ne garder que la frame en cours
   - C-x b :: buffer, afficher un buffer, avec ido noter que *C-k* permet
              de fermer un buffer.
   - ido-mode :: ajouter dans init.el ~(require 'ido)(ido-mode t)~
	permet une completion am√©lior√©e pour les ouvertures de fichiers
	et les switchs de buffer. Pour les cas o√π c'est g√™nant, on
	retrouve le comportement habituel avec un autre *C-f*. Pour les
	r√©pertoires on red√©couvre *C-x d* (Dired), mais noter que pour
	ouvrir un r√©pertoire comme un dossier, il est aussi possible
	d'utiliser *C-x f C-f*.
   - find-file-at-point :: peut √™tre appel√© via *M-x*, ou
	ajout√© *.emacs* via *(setq ido-use-filename-at-point 'guess)*
	bien plus confortable: on mixte les avantage ido et *ffap*.
   - emacsclient :: il faut avoir lanc√© le serveur dans une session
                    emacs *M-x server-start* puis *emacsclient -t
                    fichier* dans une console (et sortie par *C-x #*)
   - Ouverture d'un fichier en tant que root :: apr√®s definition
	#+BEGIN_SRC bash
	export SUDO_EDITOR='emacsclient -t '
	#+END_SRC
	utiliser *sudo -e fichier* dans une console. Depuis emacs on
	peut installer le package *sudo-edit* puis *M-x sudo-edit* puis
	saisie du nom de fichier (on peut aussi modifier un fichier
	actuellement en read-only avec *sudo-edit*).
   - M-x dired-jump :: Ouverture du r√©pertoire du fichier en cours
    
** Edition
   - M-/ :: autocompl√©tion √† partir des mots des buffers ouverts (noms
            de variables existants...)
   - C-x u :: Undo
   - M-x undo-redo :: Redo (pour clavier fr ...)
   - Keys C-h F1 :: liste tout les raccourcis commen√ßants par
                    *keys*. Mais installer le package *which-key* est
                    mieux et l'activer par d√©faut via (which-key-mode t)
   - which-key-mode :: apr√®s une demi seconde suite √† un pr√©fixe affiche
                    toutes les possibilit√©s de fonctions...
   - helm-descbinds ::
     pour une description pratique des key bindings, mais n√©cessite
     l'installation du package *helm-descbinds* depuis MELPA. Si aim√©
     ajouter un ~(global-set-key (kbd "C-h b") 'helm-descbinds)~.
   - C-x h :: s√©lectionner tout le buffer (donc *C-x h C-w* efface le
              buffer.
   - C-x C-x :: √©changer la marque et le point
   - C-^ :: join with prev line (contraire de *C-j*).
   - C-Spc C-Spc :: marquer une position pour y revenir
   - C-u C-Spc :: retour √† la marque pr√©c√©dente (dans le buffer
		courant)
   - C-x C-Spc :: retour √† la marque pr√©c√©dente (dans tous les buffers)
   - C-c % :: Marque la position courante pour y revenir plus tard (liste cumulative)
              semble limit√© au mode org, mais √† se g√©n√©raliser via mark-ring.el (pde)
   - C-c & :: Retourne √† la pr√©c√©dente position marqu√©e (multibuffer), limit√© aussi √† org par d√©faut
   - C-x r Spc Lettre :: Marque la position courante (fichier et ligne)
	dans le registre *Lettre*
   - C-x r j Lettre :: Retourne √† la postion du registre *Lettre*
   - M-backspace :: efface mot pr√©c√©dent
   - M-z :: zap to char, efface les caract√®res jusqu'au prochain char
   - M-; :: comment, met la r√©gion en commentaire (bascule)
   - C-x C-+ :: Grossir la police utilis√©e dans le buffer (*C-x C--*
		pour diminuer). Juste apr√®s on peut changer avec une
		des touches +, - ou 0 (retour √† conf initiale)
   - C-x = :: Affiche tout sur le caract√®re sous le curseur (code
              ASCII, position...)
   - C-q :: escape next key (pour ins√©rer une touche sp√©ciale, la taper
            apr√®s)
   - Esc-Space :: r√©duit le nombre d'espaces entre les deux mots √† 1
   - C-u M-| :: remplace la r√©gion par le r√©sultat de son passage par
		une commande shell. Ex: sort, grep ... (sans *C-u*
		affiche le r√©sultat temporairement, et l'envoi dans le
		buffer *Shell Command Output*)
   - C-u M-! :: ins√®re le r√©sultat d'une commande shell dans le buffer
		courant
   - desktop-save-mode :: ajouter dans init.el (desktop-save-mode 1)
	pour retrouver les buffers ouverts et leurs position lors du
	prochain d√©marrage.
   - M-x revert-buffer-with-coding-system :: (C-x RET r) en pr√©cisant au prompt
	l'encodage en *UTF-8* permet de lire des fichier org issus de
	Linux dans Windows. Noter que pour ne plus se poser la
	question, il est possible d'en faire le choix par d√©faut via
	une ligne dans init.el:
	*(prefer-coding-system 'utf-8)*
   - set-buffer-file-coding-system :: semble permettre de corriger des
     err d'encodage (puis utf-16 ou UTF-8) on peut v√©rifier en clair la
     valeur actuelle de l'encodage du fichier avec *C-h v
     buffer-file-coding-system* (le fichier sera modifi√© sur disque apr√®s sa sauvegarde)
   - M-x recode-region :: doit permettre de corriger l'encodage d'une
	r√©gion (mais d√©pend de la connaissance de l'ancien encodage)
     - Forcer l'encodage du fichier via la modeline suivante:
       #+begin_example
       ;; Emacs 23 is unable to open this file properly:
       -*- coding: utf-16 -*- (ou latin-1 ou UTF-8)
       #+end_example
   - M-C-v :: Scroll l'autre fen√™tre d'un √©cran vers le bas (aide, man,
              ...) et *M-C-V* dans l'autre sens.
   - C-x C-q :: bascule le mode Read-Only (de oui √† non)
   - M-x revert-buffer :: pour revenir √† la version enregistr√©e du buffer.
     - pour un revert sans confirmation piste d'ajout dans init.el de
       ~(global-set-key (kbd "C-c !") (lambda () (interactive)
       (revert-buffer t t)))~
   - M-x auto-revert-tail-mode :: pour un fichier de log permet de se
	maintenir √† la fin et d'en afficher le contenu toujours √† jour

*** Narrowing
    Pour se concentrer sur une partie du buffer en cours.
    - Le pr√©fixe de ces commandes est *C-x n*
      - s :: Subtree, dans un Org file, permet de restreindre au titre courant
      - d :: Defun, dans un source pour restreindre √† la d√©finition de la fonction courante
      - w :: widen pour ne plus restreindre et retrouver le buffer complet
       
** Recherches
   - M-x show-parent-mode  :: permet l'affichage de l'autre
	parenth√®se... pour s'y d√©placer on a *C-M-n* et *C-M-p*
   - C-s/r :: recherche incrementale (r pour reverse), noter qu'on
              retourne au point de d√©part par *C-g* et que *C-w* ins√®re le
              mot sous le curseur (r√©p√©t√© plusieurs fois, ajoute le mot
              suivant).

   Pour rechercher ou marquer une regexp dans le buffer
   - M-s o :: Occur, ouvre dans un buffer tous les match de la regexp
              (comme r√©sultat de compilation). *g* permet de rafra√Æchir
              le r√©sultat de la requ√™te. Dans le fichier *M-g n* pour
              le prochain match.
   - M-s w :: recherche un mot (*C-w* pour le mot courant) dans le
              buffer.
   - M-s h r :: Highlight Regexp, avec choix de couleur
   - M-x grep :: pr√©ciser la regexp puis le filtre de fichiers
   - M-x rgrep :: recursive, idem mais plus interactif
   - M-x lgrep :: local, idem mais un seul niveau de r√©pertoire
   - M-g M-n :: permet de se placer sur la prochaine occurence trouv√©e
		par le dernier grep (*M-g M-p* pour la pr√©c√©dente)

   - C-c C-j :: imenu jump to definition (si programme) ou titre pour
		org. Permet en particulier le rescan des tags de
		speedbar via *C-c C-j * Tab Enter Enter* puis r√©ouvrir
		speedbar.
   - M-g g :: goto-line
   - M-g c :: goto-char (position en nombre de caract√®res, utile dans certaines erreurs elis)
   - M-x speedbar :: permet une fen·∫øtre qui affiche sous forme d'arbre
                     le r√©pertoire courant ou les buffers ouverts. Dans
                     le cas de sources, utilise imenu pour afficher les
                     classes et fonctions
     - Enter :: pour ouvrir le fichier
     - f :: pour afficher les fichiers
     - b :: pour les buffers ouverts
     - k :: pour fermer le buffer
     - D :: pour effacer le fichier (avec confirmation)
     - g :: pour rafra√Æchir si n√©cessaire
     - q :: pour quitter
	   
** Marquage de position dans des fichiers
   - C-c % :: marque la position courante du fichier en court
   - C-c & :: retourne √† la derni√®re position marqu√©e. Si utilis√©
     plusieurs fois propose les pr√©c√©dentss
    
** Fen√™tres multiples
   - C-x 0 :: cache la fen√™tre en cours
   - C-x 1 :: cache toutes les autre fen√™tres ou *Esc Esc Esc* 
   - C-x 2 :: S√©pare la fen√™tre en cours horizontalement
   - C-x 3 :: S√©pare la fen√™tre en cours verticalement
   - C-x o :: Passage √† la fen√™tre suivante
   - C-x ^ :: Agrandir verticalement la fen√™tre
   - C-x { et } :: Agrandir horizontalement (respectivement vers la
                   gauche, la doite)
   - M-x elscreen :: si les fen√™tres ne suffisent pas, voir le package
                     elscreen puis *elscreen-start* qui permet
                     d'utiliser des onglets dans lesquels on a autant
                     de r√©partitions de fen√™tres. Utilisable avec la
                     souris.
     - C-z c :: permet de cr√©er un nouvel onglet
     - C-z n :: passer √† l'onglet suivant (*p* pr√©c√©dent)
     - C-z 0 .. 9 :: pour aller √† l'onglet n
     - Il reste √† trouver comment y lancer aptitude (pb de TERM ?)
		  
** Fichier de configuration: .emacs et .emacs.d/init.el
*** assignation de touches 
**** Pour projet python
     #+BEGIN_SRC emacs-lisp
       (global-set-key
	(kbd "C-x C-g")
	(lambda () (interactive) (python-django-open-project "~/Dropbox/retrouve" "retrouve.settings")))
     #+END_SRC
**** Ouvrir le r√©pertoire du fichier courant 
     (global-set-key "\C-xj" 'dired-jump) ;
*** Couleurs et masquage du menu / ic√¥nes
    - Pour √©viter le fond noir en mode texte, essayer *M-x load-theme
      whitheboard* ou *dichromacy*
    - pour afficher la colonne courante: *M-x column-number-mode*
    - M-x linum-mode ::affiche les no de lignes du buffer.
    - Si c'est en mode texte (-nw ou serveur en SSH) il faut ajouter
      - dans .bashrc ~export TERM=xterm-256color~
      - ou son √©quivallent zsh ~.zshrc~ les th√®mes qui semblent bien
	sont par exemple wombat et misterioso (sur un ubuntu r√©cent ?)
    - Masquage des menu et toolbar
      #+begin_src elisp
	(menu-bar-mode -1)
	(tool-bar-mode -1)
      #+end_src    
*** use-package pour chargement diff√©r√© de packages
    - Suppose l'installation du package *use-package*
    - L'utilisation basique est ~(use-package nom-package :defer t)~
    - Pour charger lors d'une commande initiale, utiliser un param du
      type ~:commands xxx-mode~
    - Voir la substitution d'une macro via (compl√©ter !)
    
*** Divers autre
     #+BEGIN_SRC elisp
       (ido-mode t)
       ;;(ffap-bindings)
       (setq ido-use-filename-at-point 'guess)
       (load-library "iso-transl")
       (desktop-save-mode 1)
       (setq auto-save-default nil)  ; Pour ne plus faire d'autosave (TRAMP ...)
       (setq org-export-dispatch-use-expert-ui 1)
       (xterm-mouse-mode 1) ; Pour avoir un support souris dans un emacs dans terminal
       (require 'realgud) ; Pour debug de bash
     #+END_SRC
*** Exemple avec helm+magit
    Noter qu'il faut installer les packages use-package, helm et magit
    #+begin_src elisp
      (package-initialize)

      ;; Aspect
      ;;(load-theme 'dichromacy)
      (load-theme 'wheatgrass)
      (setq inhibit-splash-screen t)
      (menu-bar-mode 0)
      (global-set-key (kbd "<f8>") 'menu-bar-open)

      ;; Ajouts de packages MELPA
      (when (>= emacs-major-version 24)
	(require 'package)
	(add-to-list 'package-archives '("gnu" . "https://elpa.gnu.org/packages/"))
	;;(add-to-list 'package-archives '("nongnu" . "https://elpa.nongnu.org/packages/"))
	(add-to-list 'package-archives '("melpa" . "https://melpa.org/packages/")))
      (use-package  helm :ensure t)
      (require 'helm-config)
      (global-set-key (kbd "C-x C-f") 'helm-find-files)
      (global-set-key (kbd "C-x b") 'helm-buffers-list)
      (global-set-key (kbd "C-x rb") 'helm-bookmarks)
      (global-set-key (kbd "M-s o") 'helm-occur)
      (global-set-key (kbd "M-x") 'helm-M-x)
      (global-set-key (kbd "M-y") 'helm-show-kill-ring)
      (global-set-key (kbd "C-h i") 'helm-info)
      ;;(global-set-key (kbd "<f2><f2>") 'helm-calcul-expression)
      ;;(setq tramp-default-method "ssh")
      ;;(define-key global-map (kbd "C-c s") 'helm-tramp)

      (custom-set-variables
       ;; custom-set-variables was added by Custom.
       ;; If you edit it by hand, you could mess it up, so be careful.
       ;; Your init file should contain only one such instance.
       ;; If there is more than one, they won't work right.
       '(package-check-signature nil)
       '(package-selected-packages
	 (quote
	  (use-package helm magit gnu-elpa-keyring-update php-mode))))
      (custom-set-faces
       ;; custom-set-faces was added by Custom.
       ;; If you edit it by hand, you could mess it up, so be careful.
       ;; Your init file should contain only one such instance.
       ;; If there is more than one, they won't work right.
    #+end_src
** helm et listes plus puissantes
   - Suppose l'installation du package *helm*
   - Voir une prise en main dans https://boruch-baum.github.io/emacs_mini_manual/helm-intro.html
   - Affiche des listes dynamiquement mises √† jour en fonction du pattern tap√©
   - possibilit√© de plusieurs pattern s√©par√©s par espacs, et de *!*
     pour exclure. Et d'√©chapper des caract√®res sp√©ciaux avec *\*,
     comme pour SPACE.
     - @xx :: recherche xx dans le contenu des buffers
     - *xx :: recherche par les noms de major-mode (shell, dired, lisp ...)
     - /xx :: recherche par le nom du r√©pertoire du buffer
   - TAB :: affiche des actions sur l'√©l√©ment s√©lectionn√©
   - C-SPACE :: pour s√©lectionner plusieurs √©l√©ments de la liste
   - F2 :: dans helm-M-x permet d'avoir la doc emacs de la fonction s√©lectionn√©e
   - C-x f C-S :: pour faire une *recherche dans tous les fichiers du
     r√©pertoire* (type grep) √† partir de l'endroit o√π on a commenc√© un
     find file
   - C-t :: pour d√©placer le fen√™tre des suggestions (bascule)
   - Une configuration type r√©cup√©r√©e sur youtube est
   #+begin_src elisp
     (use-package  helm :ensure t)
     (require 'helm-config)
     (helm-mode 1) 	 
     (setq helm-split-window-inside-p t)
     (global-set-key (kbd "C-x C-f") 'helm-find-files)
     (global-set-key (kbd "C-x b") 'helm-buffers-list)
     (global-set-key (kbd "C-x rl") 'helm-bookmarks)
     (global-set-key (kbd "M-s") 'helm-occur)
     (global-set-key (kbd "M-x") 'helm-M-x)
     (global-set-key (kbd "M-y") 'helm-show-kill-ring)
     (global-set-key (kbd "C-h i") 'helm-info)
     (global-set-key (kbd "<f2><f2>") 'helm-calcul-expression)
   #+end_src
*** Ecrire une extension √† Helm
  Voir https://wikemacs.org/wiki/How_to_write_helm_extensions#More_than_one_action
  Et pour un exemple impressionnnant en vid√©o, l'√©criture de helm-spotify https://www.youtube.com/watch?v=XjKtkEMUYGc
  - L'appel principal est ~(helm :sources var-src :prompt "Saisir XX: ")~
  - Les sources peuvent √™tre du type
    #+begin_src elisp
      (setq var-src- '((name . "S√©lection base Oracle sur ProxMox")
	      (candidates . bases-proxmox)
	      (action . (("Ouvrir le buffer shell de la s√©lection" . (lambda (x)
								       (message "Affichage shell de %s sur %s" x (assq x bases-proxmox))))
			 ("Ouverture d'un dired en adminXX" . (lambda (x)
								(message "Ouverture de dired sur %s de %s en adminXXXX"
									 x (assq x bases-proxmox))))
			 ("Ouverture d'un dired en root" . en-vrai)
			 ("Startup mount" . (lambda (x) (en-vrai x "startup mount")))
			 ("Shutdown immediate" . (lambda (x) (en-vrai x "shutdown immediate")))))))
    #+end_src
  
** Themes et Font
   - Font - Suggestions youtube
     - M-x customize
     - Rechercher *Faces* puis *Basic Faces* et *Default*
     - Font Family :: xos4 Terminus
     - Height :: 90 √† 120
     - D√©cocher *Foreground* et *Background*
   - Coding font voir https://www.codingfont.com/
     - permet de tester par comparaison successives sur un m√™me texte
     - j'ai choisi et t√©l√©charg√© *NovaMono* qu'on peut activer avec
       ~(set-frame-font "NovaMono-11")~
   - Theme spacemax
     - Installer via *M-x package-list-packages* choisir *spacsmax-theme*
     - L'activer via *M-x customize-themes*
     - Pour le mode terminal, penser √† ~export TERM=xterm-256color~
   - Pour revenir √† une police fixe ~(set-frame-font "DejaVu Sans Mono-14" nil t)~
      
** Rectangles
    Le rectangle est d√©finit par ses deux coins (Mark et Point) et les
    commandes suivantes sont disponibles:
    - C-x r M-w :: copier la s√©lection en tant que rectangle
    - C-x r k :: kill, supprime le rectangle et le garde dans le kill ring
    - C-x r y :: yank, colle le contenu du rectangle
    - C-x r o :: open, d√©cale le texte en ins√©rant un rectangle de la
	 taille de la s√©lection (place des espaces qui √©cale le reste
	 vers la droite.
    - C-x r t :: ins√®re une cha√Æne devant toutes les lignes du rectangle
    - C-x SPC :: d√©but du marquage d'un rectangle, permet via *M-w* et
	 *C-y* de copier coller le rectangle.  
** Bookmarks
   - C-x r l :: List Bookmarks (stock√© dans ~/.emacs.d/bookmarks)
   - C-x r m :: Mark new Bookmark
   - Dans la liste :: les touches principales sont:
     - Enter :: pour afficher le fichier marqu√©
     - d :: delete, pour marquer un bookmark pour effacement
     - u :: unmark, pour retirer la marque de la ligne courante
     - x :: pour ex√©cuter les effacements demand√©s.
   - C-x r C-SPC :: Stocker la position courante dans un registre
		    (chosir une lettre)
   - C-x r j :: Jump, retourner au point stock√© dans le registre (taper
		la lettre chosie comme registre)
   - Nautilus :: le fichier d√©finissant les bookmarks Ubuntu est dans
		 ~/.config/gtk-3.0/bookmarks et il est recharg√© d√®s sa
		 sauvegarde.

** Onglets - tabs
   Pour afficher ou cacher les onglets *M-x tab-bar-mode*
   - C-x t 2 :: Cr√©e un nouvel onglet (tab-new)
   - C-x t o :: S√©lectionner l'onglet suivant
   - C-x t 0 :: Ferme l'onglet courant
   - C-x t 1 :: Ferme tous les onglets sauf le courant
   - C-x t ? :: Aide sur les autres raccourcis
   Voir pour faire des raccourcis plus faciles ?
   On peut aussi renommer l'onglet courant via ~tab-bar-rename-tab NOM~
     
** Abr√©viations

   - C-x aig :: abbrev inverse global, √† taper apr√®s l'abr√©viation, il
		 faut ensuite saisir le texte complet, termin√© par
		 return. Il est possible de coller un texte multiligne.
   - M-x list-abbrevs :: Affiche tous les tables d'abr√©viations
	 courantes, avec possibilit√© d'en effacer (C-k) ou d'en
	 modifier. Il faut utiliser *C-c C-c* pour valider les
	 modifications.
   - M-x abbrev-mode :: Active le mode abbrev pour le buffer en cours
	 (bascule)

** Squelettes
   - d√©finition en lisp du type
     #+BEGIN_SRC emacs-lisp
       (define-skeleton hello-world-skeleton
	  "Write a greeting (commentaire)"
	  "Type name of user (prompt) : "
	  > "hello, " str "!" \n >
	  "I need " _ ", and you are the person for it..." \n
	  "--" \n "La direction")
     #+END_SRC
     - str :: est remplac√© par la saisie utilisateur
     - ~_~ :: permet de placer la position du curseur
     - > :: augmente l'indentation (si cela a un sens dans le mode courant)
     - \n :: ins√®re un saut de ligne
     - -NN :: recule de NN caract√®res

   - Exemples:
     #+BEGIN_SRC emacs-lisp
       (define-skeleton html-skeleton
	  "Ins√®re une page HTML basique avec un titre √† saisir..."
	  "Titre de la page : "
	  "<html>" \n
	  > "<head>" \n
	  > "<title>" str "</title>" \n
	  -2 "</head>" \n
	  > "<body>" \n
	  > "<p>" _ "</p>" \n
	  -2 "</body>" \n
	  -2 "</html>")
       (define-skeleton org-skel
	  "En t√™te pour mes fichiers org"
	  "Titre : "
	  "#+TITLE: " str \n
	  "#DATE: " (date) \n
	  "#+OPTIONS: toc:nil" \n
	  "#+SETUPFILE: theme-readtheorg-local.setup" \n
	  "#+AUTHOR: Pierre DEDIEU" \n
	  "#+Email: MangeChats@gmail.com" \n \n)
       (global-set-key "\C-ch" 'org-skel)
    #+END_SRC 
   
** Sauvegarde de layouts avec workgroup2
   - Utiliser le package *workgroup2*
   - C-c z C-c :: create wg, demande un nom pour sauver le layout courant
   - C-c z C-v :: open wg, permet de choisir et de restaurer un des layouts sauv√©s
   - En compl√©ment ~(desktop-save-mode 1)~ dans *init.el* permet de restaurer les buffers ouverts au d√©marage d'emacs
   - Plus l√©ger et efficace *winner-mode* qui permet via *C-<left>* et
     *C-<right>* de retrouver le layout pr√©c√©dent / suivant.
   - En compl√©ment, *ace-window* permet de passer par no d'une des
     fen√™tres √† une autre (raccourci sugg√©r√© *M-o*)
    
** V√©rification de l'orthographe
   via les paquet *ispell* et *aspell-fr*.
   - M-x flyspell-mode :: pour une v√©rification des mots d√®s leur
	frappe. Comme c'est la solution que je pr√©f√®re je lui d√©die F5:
	~(global-set-key (kbd "<f5>") 'flyspell-mode)~
   - M-$ :: Pour le mot courant (en flyspell-mode c'est une correction
	    facile). Les alternatives sont *C-M-i* et *ESC i*
   - M-x ispell-buffer :: pour proposer des choix de correction en fran√ßais
   - M-x ispell-region :: RAS
   - M-x flyspell-buffer :: permet de souligner les erreurs apr√®s
	v√©rification de tout le buffer mais les corrections sont
	laborieuses, voir plut√¥t flyspell-mode.
   - M-x flyspell-goto-next-error :: vraiment mieux si assign√© via
	~(global-set-key (kbd "<f5>") 'flyspell-goto-next-error)~
   - M-x flyspell-correct-word-before-point :: gagnerait √† √™tre assign√©
	√† une touche ?
	mouse-2 down doit √™tre maintenu pour voir les
	choix propos√©s (seuls les boutons du bas marchent pour cela sur
	mon PC HP !).

** Packages
  installation de packages suppl√©mentaires depuis internet
  - M-x list-packages :: affiche la liste des noms disponibles dans le
       d√©p√¥t d√©fini, puis Entr√©e sur un nom donne quelques infos
       compl√©mentaires et permet d'installer. (ex: ido-ubiquous)
  - D√©finir quel shell utiliser :: pour que la valeur par d√©faut soit
       chang√©e un param√®tre √† mettre dans le init.el:
       '(python-shell-interpreter "python3") qui peut aussi se changer
       via *Customize*
  - ajouter le d√©p√¥t MELPA :: il faut ajouter dans ~/.emacs les
       lignes. Voir quelle URL est la plus int√©ressante
       #+BEGIN_SRC emacs-lisp
	 (when (>= emacs-major-version 24)
	   (require 'package)
	   (add-to-list 'package-archives '("gnu" . "https://elpa.gnu.org/packages/"))
	   ;;(add-to-list 'package-archives '("nongnu" . "https://elpa.nongnu.org/packages/"))
	   (add-to-list 'package-archives '("melpa" . "https://melpa.org/packages/"))
	   (package-initialize))
       #+END_SRC
  - Pour les erreur de clef GPG au chargement essayer
    ~gpg --homedir ~/.emacs.d/elpa/gnupg --receive-keys 066DAFCB81E42C40~
  - Puis il faut rafra√Æchir la liste des packages avec la touche *r*.
  - On peut s√©lectionner un package avec *i* et installer la s√©lection
    avec *x*
*** D√©tail
  une source est [[http://melpa.org/#/getting-started]] suppose de
  l'ajouter dans init.el ... puis via l'acc√®s internet l'installation
  se fait via la commande *package-list-packages*. Voir mode-php,
  python-django ...

** Documentation en Markdown
   - installer *markdown-mode*
   - permet surtout un affichage des enrichissements
     
** Affichage des commandes
   - Installer le package *command-log*
   - Lancer commande *command-log-mode*
   - C-c o :: Bascule l'affichage ou non des derni√®res commandes

** God mode
   Avec le paquet *god-mode* pour taper directement le commandes n√©cessitant l'utilisation de la touche *Control*
   - Bascule de ce mode mineur avec ~(god-mode-all)~ ou ~(god-local-mode)~
     - Je propose ~(global-set-key "C-¬≤" 'god-local-mode)~
   - pr√©c√©der une LETTRE de *g* pour ins√©rer *M-LETTRE*
   - pr√©c√©der une lettre de *G* pour ins√©rer *C-M-LETTRE*
   - pour taper une suite de *lettres sans Control*, les pr√©fixer d'un espace
     
** multiple-cursors
   - Voir le [[https://github.com/magnars/multiple-cursors.el][README]] du Git
   - ajouter dans *init.el* ~(require 'multiple-cursors)~
   - utiliser des set-key car les appels via *M-x* buggent
   - mc/edit-lines :: pour mettre un curseur devant chaque ligne de la selection courante
   - mc/mark-next-like-this :: place un curseur avant le prochain match du mot s√©lectionn√©
   - mc/mark-all-like-this :: pour tous les matchs
     #+begin_src elisp
       (require 'multiple-cursors)
       (global-set-key (kbd "C-c √† √†") 'set-rectangular-region-anchor)
       (global-set-key (kbd "C-c √† l") 'mc/edit-lines)
       (global-set-key (kbd "C-c √† a") 'mc/mark-all-like-this)
       (global-set-key (kbd "C-c √† n") 'mc/mark-next-like-this)
     #+end_src
     
*** cua-mode pour curseurs multiples
   - M-x cua-mode :: activer le mode (toggle, attention aux conflits des touches std emacs)
   - C-Enter :: marquer le d√©but de la s√©lection cua,
    puis d√©placer le curseur avec les fl√®ches pour √©tendre la s√©lection
    et terminer par *M-Enter*
		    
** Autre
   - M-x toggle-truncate-lines :: Pour changer la coupure des lignes longues
   - C-h l :: view-loosage, affiche un buffer avec les derni√®res commandes tap√©es
   - M-x : (buffer-file-name) :: affiche le chmin complet du fichier associ√© au buffer courant
   - M-x white-space-mode :: toggle, permet d'afficher les espaces (gros points) et les fins de ligne ($)
   - M-x find-name-dired :: affiche dans un dired tout les fichiers √†
     partir d'un r√©pertoire de d√©part dont le nom correspond √† un nom
     (avec * comme wildcar)
   - M-: :: √©valuer du code elisp, exemple ~(current-buffer)~ mais pour
     avoir le r√©pertoire *C-x b* est plus complet
   - M-x prettify-symbols-mode :: permet l'affichage de symboles UTF-8
     √† la place de leur noms pour les modes qui le supportent, par
     exemple pour afficher lambda Œª dans un source lisp on a
     *prettify-symbols-alist* qui vaut ~(("lambda" . 955))~ car code 955
     en d√©cimal
     - utiliser ~(global-prettify-symbols-mode 1)~ dans init.el pour le
       g√©n√©ralser
   - C-x 8 Ret :: Lit un caract√®re UTF8 par nom ou no et l'ins√®re
     - on peut taper ~*substring~ puis tabulation pour la compl√©tion
     - üòâ ou üßê üò¢ üëç üëé üíã üòé ü§≠ sont possibles
     - ajouter via abbrev des raccourcis pour cela avec ~M-x list-abbrevs~
       puis par exemple saisir (et valider par *C-c C-c*)
       #+begin_example
       "bg"	       3    "üêõüêõüêõüêõ"
       "ks"	       1    "üíã"
       "lm"	       1    "Œª"
       "sg"	       1    "üòé"
       "tdo"	       1    "üëé"
       "tup"	       1    "üëç"
       #+end_example
** Installer emacs sur un Ubuntu neuf
 - installer le paquet emacs
 - Ajouter les lignes pour avoir Melpa (dans *~/.emacs.d/init.el*)
 - utiliser M-x package-init-package pour installer des paquets minimum
   - use-package
   - org-roam-ui
 - ajouter un theme, et le param√©trage de org et helm
 - optionnellement installer les fichiers info pour emacs et elisp via
   ~apt install emacs-common-non-dfsg~ qui permet par exemple la
   consultation avec M-x ~emacs-index-search~ et ~elisp-index-search~
*** Installer une version plus r√©cente
   - avec un d√©p√¥t sp√©cifique ~apt-add-repository ppa:ubuntu-elisp/ppa~
     + ~apt update~ puis ~apt-get install emacs-snapshot~
     + et pour revenir en arri√®re ~add-apt-repository --remove ppa:ubuntu-elisp/ppa~
     + puis ~apt remove emacs-snapshot~
   - avec snap
     - ~apt remove emacs emacs-gui~ puis ~snap install emacs --classic~
     - et pour la d√©sinstallation ~snap remove emacs~
   - il est aussi possible de le faire via flatpack, voir https://learnubuntu.com/install-emacs/
* Int√©gration OS
** R√©pertoires
   - C-x d :: Dired, Directory Edition. Si on veut on peut pr√©ciser un
              filtre pour les fichiers √† lister genre
	      ~/var/log/Vulture/worker/*.access.log~ pour ne lister que les logs
	      actifs de Vulture3 par exemple
     - m/u :: mark / unmark, pour s√©lectionner / d√©selectionner le
              fichier sous le curseur
     - D :: Delete, efface les fichiers s√©lectionn√©s
     - k :: retire les fichiers s√©lectionn√©s de l'affichage
     - U :: Unmark all, d√©-s√©lectionne tout
     - a :: au lieu de Return sur un r√©pertoire permet de le visiter
       sans conserver le dired source (comande √† confirmer comme
       dangeureuse)
     - j :: jump demande un nom de fichier du repertoire courant et positionne le curseur dessus
     - M :: Mode, pour changer le mode du fichier courant (saisir a+x ou 655 par exemple)
     - O :: Owner pour changer le proprit√©aire du fichier
     - %m :: pour s√©lectionner des fichiers via une regex (\.py$ ou ~$
             par exemple)
     - A :: pour rechercher un mot dans les fichiers marqu√©s et se
            placer √† la premi√®re occurrence du premier fichier (puis
            utiliser *M-;* pour se placer sur l'occurrence suivante)
     - Q :: pour faire un search / replace sur tous les fichiers
            s√©lectionn√©s (avec confirmation). Cela ne sauve pas les
            fichiers modifi√©s, √† faire par exemple avec *C-x s*.
     - i :: si plac√© sur un r√©pertoire, ajoute la liste de ses fichiers
            √† la fin du buffer. Puis *$* pour replier ou *C-u k* pour
            retirer le r√©pertoire du listing
   - C-u s :: pour changer l'ordre du tri ou le format d'affichage (voir man ls)
     - -latS :: trier par taille de fichier d√©croissant
     - -lah :: tailles en human readable
     - -lR :: affiche r√©cursivement le contenu
   - $ :: replie/d√©plie un sous r√©pertoire quand dired en liste plusieurs
   - M-x find-name-dired :: affiche dans un dired les fichiers
	correspondants √† un nom
   - M-x find-grep-dired :: afficher dans un dired les fichiers dont le
	contenu match une regexp
       
** Impressions
    - Je recommande la fonction *ps-print-with-faces*
    - Attention il faut que l'imprimante CUPS soit d√©finie comme
      imprimante par d√©faut de lpr
      - pour cela il faut consulter http://localhost:631
      - dans *Imprimantes* choisir pour la bonne imprimante list√©e la
	t√¢che d'administration *D√©finir par d√©faut*
    - Elle peut √™tre customis√©e via *ps-print-customize*, en particulier
      j'ai retenu:
      - Ps N Up printing :: √† *2* pour mettre 2 pages par page A4.
      - Ps N Up Border P :: √† *off* pour √©viter des cadres inutiles
    - Dans *ps-print Ps Lpr Switches* voir *-o
      sides=two-sided-long-edge* pour faire du recto/verso

** Calculatrices
*** Calculatrice RPN
    acc√®s par *C-x * c*
    - ??... :: pour les aides en mini buffer
    - q :: pour quit
    - y :: yank (colle le top dans le buffer d'origine)
    - U :: undo
    - D :: redo
    - p NN :: ajuste la pr√©cision √† NN chiffres (2000 possible!)
    - ds :: affichage scientifique (argument optionnel = nb de chiffres)
    - dn :: retour affichage normal
    - ch :: affiche en Heure Minutes Secondes (dh permet d'en d√©finir
	    le format). Les saisies directes se font par ex. comme
	    11h12m30
    - 16#XXX :: saisie de chiffres en hexa
    - d NN :: Affichage en base NN
    - dB et dO :: affiche en big ou normal les formules
    - ms :: bascule, mode calcul symbolique (les racines ou quotients restent...)
    - mf :: bascule, les fractions restent (et se simplifient) (*cf*
	    pour la calculer), on peut changer cet affichage cia *do*
	    qui demande un s√©parateur (/ ou : par exemple, mais +/
	    permet d'isoler la partie enti√®re)
    - cF :: convertie en fraction
    - g :: groupe les chiffres 3 par 3 (ou autre)
    - td :: Affiche ou cache l'historique (trail)
    - tn ou tp :: previous ou next du Trail
    - t[ ou t] :: d√©but ou fin du trail
    - ty :: paste le chiffre choisi du trail
    - dt :: Truncate stack, ins√®re temporairement le point √† la
	    position du curseur
    - Alt-Gr 7 Alt-Gr 7 :: Pour √©diter une entr√©e de la pile (sortir avec *Ret*)
    - ' :: Alg√©brique, permet aussi la saisie de valeur avec leurs
	   unit√©s (mi/hr km ...)
      - mO :: d√©sactive les simplifications alg√©briques par d√©faut, on
	      peut les faire alors via *av* (qui ne substitue pas les
	      variables par leurs valeurs contrairement √† *=*). Voir
	      aussi *ae* qui fait les simplifications √©tendues.
      - cu :: permet de saisir une autre unit√© de destination.
      - aS :: Solve, demande la variable selon laquelle r√©soudre,
	      marche pour des polyn√¥mes, des syst√®mes d'√©quations...
      - aC :: Collect, pour d√©velopper selon une variable
      - af :: Fatorize, pour factoriser dans la mesure du possible,
	      selon une variable.
      - aD :: D√©river, pr√©ciser selon quelle variable ET *ms* est votre ami (Symbolique !)
      - aI :: Int√©grer, demande de pr√©ciser selon quelle variable.
      - M-u aI :: Int√©grale d√©finie avec bornes: pr√©ciser les bornes de d√©but / fin
    - [x + y = a , x y = 1] :: saisie d'un syst√®me d'√©quations,
	 puis *aS x,y* donne les solutions
    - ' <31 aug 64> :: saisie de ma date de naissance
    - hk tN :: lire la doc de *tN*

*** Quick calc
    - M-x quick-calc :: Calculatrice alg√©brique simple, √©crire la
			formule √† √©valuer, Enter affiche le
			r√©sultat. Puis R√©sultat r√©cup√©rable par *C-y*.

*** Calculatrice Embedded
    Pour √©crire des devoirs de math ou physique. On r√©dige un document
    principal, en particulier en mode org ou LaTex et on d√©limite des
    formules, par exemple en les entourant de *$$* ou de lignes vides
    (recommand√©).  calc-embedded, o√π on peut utiliser les commandes
    - C-x * e :: Edit, permet de passer la formule courante en √©dition
		 de la calculatrice classique sur la formule
		 alg√©brique courante. En particulier on peut en
		 changer les unit√©es via *cu*, ou l'√©valuer
		 via *=*. Pour retourner √† l'√©dition normale du
		 buffer, utiliser *C-x * e*. Deux cas particuliers:
		 l'assignation via *:=* et l'utilisation de *=>* en
		 fin de ligne pour faire afficher l'√©valuation de
		 la formule (cumulable avec une assignation).
    - C-x * d :: Duplicate, pour copier la formule en cours sur une
	       autre ligne (pour la faire √©voluer, en d√©veloppant,
	       r√©duisant, changeant d'unit√©s ...)
    - C-x a :: All, permet de parcourir tout le fichier et d'interpr√©ter
	       toutes les formules trouv√©es.
    - C-x u :: Update, permet de rafra√Æchir le calcul sous le curseur.
    - C-x * AltGr 7 AltGr7 :: pour modifier la formule sous le
	 curseur. Sortir ensuite via *Ret*.
    - C-x * j :: Permet de s√©lectionner une partie de la formule pour
		 l'√©diter... je ne ma√Ætrise pas pour l'instant!
    - C-x * g :: Grab, met la s√©lection dans la calculatrice (en
		 vecteur si espaces ou multiligne)
    - C-x * r :: Rectangle, pour d√©finir en matrice la s√©lection
    - C-x * ~_~ :: somme les lignes d'une matrice (donne un vecteur)
    - C-x * : :: somme les colonnes d'une matrice (donne un vecteur)

*** helm-calcul-expression
    Pour un rapide calcul avec *Enter* pour r√©cup√©rer le r√©sultat dans
    le kill-ring (j'associe √† F5)
** Terminaux et Man
   - M-x shell :: Pour passer des commandes bash dans un buffer. Pour
                  en lancer un deuxi√®me sous un autre nom, utiliser
                  *C-u M-x shell*.
   - my-shell :: Pour ouvrir directement un shell sur un srv distant
     #+begin_src elisp
       (defun my-shell ()
	 (interactive)
	 (let ((default-directory "/ssh:user@host:"))
	   (shell)))
     #+end_src
   - M-x ansi-term :: (ou term) Pour lancer des programmes qui ne sont
                      pas support√©s par le shell, comme aptitude ...
                      Pour sortir du buffer penser au menu via *F10*.,
                      Noter qu'il existe deux modes, le mode *char* par
                      d√©faut, et le mode *line*
     - C-c b :: Pour passer √† un autre buffer.
     - C-c C-j :: Pour passer en mode *line* (qui permet de remonter
                  dans l'historique dans le buffer)
     - C-c C-k :: Pour revenir en mode *char*
   - M-x man :: Permet de lire les pages de manuel linux dans un buffer,
            voir aussi *Mx woman* qui est une version en lisp.
   - rdesktop :: Dans un shell, pour lancer une session RDP vers un
                 serveur, commande type:
		 ~rdesktop -uadminpdedieu -dAD-MAIRIE -g90% -r disk:linux=/tmp hdvcdad33~
   - ssh-agent :: Il est int√©ressant de d√©v√©rouiller et enregistrer sa
                  clef SSH pour la dur√©e de la session, pour cela
                  ajouter dans le *~/.profile* (attention cela bloque
                  l'ouverture de la session X)
		  #+BEGIN_EXAMPLE
		  eval $(ssh-agent -s)
		  ssh-add
		  trap 'kill $SSH_AGENT_PID' EXIT
		  #+END_EXAMPLE
*** eshell
    Terminal elisp
    - intercepte certaines commandes comme *grep, find, dired,
      find-file* et cr√©e un buffer pour les r√©sultat
      - dired *(Lk+5) :: ouvre un buffer dired des fichiers de + de 5 ko
      - dired *(mw-7) :: devrait ouvrir un dired des fichiers modifi√©s
        depuis moins de 7 jours mair retourne *invalid function 25549*
    - globing
      - *(filter) :: globing avec un filtre (ou cumul de plusieurs parmis les suivants)
	- . :: que les fichier
	- / :: que les r√©pertoires
	- L+50 :: les fichiers de +de 50 octets
	- Lk-500:: les fichiers de moins de 500 Ko
	- ms-50 :: les fichiers modifi√© depuis moins de 50 secondes
      - C-c M-q :: aide concernant les predicates (dont tous les filtres)
      - D√©finition de nouveaux predicates ::
        d√©finir une nouvelle fonction elisp 'mon-file-predicate ici
        avec un param *file* qui retourne true si on doit retenir le
        fichier et pour ajouter le predicat
        #+begin_src elisp
	(add-hook 'eshell-pred-load-hook (lambda ())
	  (add-to-list 'eshell-predicate-alist
          '(?U . 'mon-file-predicate)))
	#+end_src
    - list modifier (aide par *C-c M-m*)
      - "Hello"(:U) :: to Upper case
      - echo *(:L) :: retourne la liste des noms de fichiers en minuscules
      - echo ini*(:e:j/ | /) :: retourne une cha√Æne des extensions des
        fichiers commen√ßant par ini s√©par√©s par des ' | '
    - deux interpr√©teurs en m√™me temps: shell et elisp
    - definition de fonction elisp (defun XXX ())
      - Pour d√©finir des fonctions dans le mode shell (defun eshell/ma-fonc () ...)
      - Pour utiliser une fonction std masqu√©e par une perso avec *ma-fonc
      - Pour tester si une fonction a √©t√© pr√©fix√©e, voir ~current-prefix-arg~
	- si pas pr√©fix√©e c'est nil
	- si une valeur num√©rique, c'est cette valeur
	- un simple C-u donne 4, C-u C-u donne 16
    - pipes ~command > #<buffer nom-buffer>~ ou ~#<nom-buffer>~
      - id√©e de fonction bargs pour appliquer une fonction √† toutes les lignes d'un buffer
    - tramp
      - *(default-directory "ssh://root@serveur:/")*
      - Apr√®s quoi il est possible de faire un *dired* ou un *find-file*
        sur le serveur distant
    - Programmes non compatibles: ajouter √† la liste
      *'eshell-visual-commands* les noms des programmes comme *aptitude*
      ~(add-to-list 'eshell-visual-commands "aptitude")~
    - Boucle sur une recherche ~for fic i in *.yml { bloc √† exec }~
    - Utiliser des parenth√®ses pour forcer le mode lisp
	
** Serveur emacs
   - Permet d'avoir un emacs qui tourne en arri√®re plan √† qui on envoi
     les fichiers qu'on veut ouvrir via *emacsclient*.
   - Cette edition peut √™tre ferm√©e par *c-x #* (rappel√© par un
     message)
   - ~alias ec='emacsclient -s moi'~ dans ~ ~/bash_aliases~ si le
     serveur a pour nom moi.
   - Un module gnome-shell permet de voir les serveurs d√©mar√©s et d'en
     d√©marrer un.
    
** Scripts sur un serveur distant depuis emacs
   Noter qu'on se sert de la clef SSH qui √©vite le MDP, et que le
   compte root utilis√© doit utliiser bash (zsh ne se connecte pas)
*** Examples
    #+BEGIN_SRC bash :dir /ssh:root@hdvdb18:/tmp/
      df -h /
    #+END_SRC
    
    #+RESULTS:
    | Filesystem | Size | Used | Avail | Use% | Mounted | on |
    | /dev/sda1  | 7.9G | 5.5G | 2.0G  |  74% | /       |    |
    
** EIN - Emacs IPython Notebook
   - Voir un [[http://millejoh.github.io/emacs-ipython-notebook/][site]] pour l'initiation
     
** Navigateur web interne -  eww
   - M-x eww :: Promp pour URL ou mots clefs
   - l :: last page
   - p :: previous page
   - G :: re-saissie des mots clefs ou une URL
   - b :: ajoute un bookmark pour la page en cours
   - B :: Liste des bookmarks
   - q :: Quit
	 
** Gestion des mails mu4e - Messagerie Exchange
*** Accepter le certificat du serveur Exchange
    - Copier Wildcard.pem dans /usr/share/ca-certificates/
    - Rafraichir avec ~update-ca-certificates --fresh~
*** Autre m√©thode pour accepter un certificat refus√©
    - R√©cup√©rer le certificat √† probl√®me, par exemple via
      ~openssl s_client -connect mail.rouen.fr:993 < /dev/null >/tmp/tout.txt~
    - On a alors le texte du certificat dans /tmp/tout.txt (entre autre)
    - Copier ce certificat par exemple dans /tmp/certif.pem
    - Obtenir sa signature sha256 via
      ~openssl x509 -in /tmp/certif.pem -noout -sha256 -fingerprint~
    - Utiliser cet fingerprint dans une ligne de la conf de .offlineimaprc (section concernant le serveur distant)
      ~cert_fingerprint = A6:98:9C:2B:55:42:5F:F2:A1:09:E5:F0:74:8B:86:33:37:C5:ED:8E:71:49:57:2B:F4:BA:0E:F4:7A:9D:12:E5~
    - V√©rifier que le mot de passe user est bien √† jour (!)
     
*** M√©thode plus directe
    - En cas de pb de signature, lancer ~offilneimap~ et trouver la
      signature effective dans le message d'erreur retourn√©
     
*** R√©cup√©ration des mails avec offlineimap
    - installer le paquet *offlineimap*
    - le configurer dans un fichier *~/.offlineimaprc*
      #+BEGIN_EXAMPLE
	[general]
	accounts = Rouen
	maxsyncaccounts = 3
       
	[Account Rouen]
	localrepository = LocalRouen
	remoterepository = RemoteRouen
       
	[Repository LocalRouen]
	type = Maildir
	localfolders = ~/Maildir/Rouen
       
	[Repository RemoteRouen]
	type = IMAP
	remotehost = mail.rouen.fr
	auth_mechanisms = PLAIN
	sslcacertfile = /etc/ssl/certs/ca-certificates.crt
	remoteuser = Pierre.DEDIEU@rouen.fr
	remotepass = ******
	ssl = yes
	maxconnections = 1
       
	[Account Admin]
	localrepository = LocalAdmin
	remoterepository = RemoteAdmin
       
	[Repository LocalAdmin]
	type = Maildir
	localfolders = ~/Maildir/Admin
       
	[Repository RemoteAdmin]
	type = IMAP
	remotehost = mail.rouen.fr
	auth_mechanisms = PLAIN
	sslcacertfile = /etc/ssl/certs/ca-certificates.crt
	remote_identity = admin@rouen.fr
	remoteuser = pdedieu@rouen.fr
	remotepass = ******
	ssl = yes
	maxconnections = 1
      #+END_EXAMPLE
**** Installation
    - Voir √† installer le paquet ubuntu *mu4e* (apt)
    - Pour travailler avec TB, il faut le passer le serveur en maildir
      et pas mbox (fait avec un nouveau profil via ~thunderbird -p~ puis
      utilisation d'une extension TB pour r√©cup√©rer les contenus:
      *ImportExportTools*
    - Modifier le param√®tre avanc√© de TB: Menu / Pr√©f√©rences /
      r√©f√©rences / bouton Avanc√© changer le param√®tre
      *mail.store_conversion_enabled* √† *true*
    - Clic droit sur local folder / *Parm√®tres* Type de stockage, passer
      en maildir
    - Configurer le *~/.emacs.d/init.el* pour cela (maildir issus de TB)
      mais il faut r√©cup√©rer mon fichier init.el du Max
      #+BEGIN_SRC elisp    
	;; Lire mes mails de TB
	;; (require 'org-mime)
	(add-to-list 'load-path "/usr/local/share/emacs/site-lisp/mu4e/")
	(require 'mu4e)
	(setq mu4e-maildir (expand-file-name "~/.thunderbird/s7i0rsjl.MailDir/"))
	(setq mu4e-maildir-shortcuts
	      '( ("/ImapMail/mail.rouen-1.fr/INBOX/cur"     . ?i)
		 ("/Mail/LocalFolders-maildir/Direction"   . ?d)
		 ("/drafts"   . ?b)
		 ("/ImapMail/mail.rouen-1.fr/sent"   . ?l)
		 ("/sent"      . ?s)))
	(add-to-list 'mu4e-bookmarks
		     (make-mu4e-bookmark
		      :name  "Gros messages"
		      :query "size:3M..500M"
		      :key ?g))
	(add-to-list 'mu4e-bookmarks
		     (make-mu4e-bookmark
		      :name  "Pierre Non Lus"
		      :query "not to:admin* and flag:unread"
		      :key ?p))
	(add-to-list 'mu4e-bookmarks
		     (make-mu4e-bookmark
		      :name  "Admin Non Lus"
		      :query "to:admin* and flag:unread"
		      :key ?a))
	(add-to-list 'mu4e-bookmarks
		     (make-mu4e-bookmark
		      :name  "MGO / JLE"
		      :query "from:Monique OR from:Jerome"
		      :key ?d))
		     (add-to-list 'mu4e-bookmarks
				  (make-mu4e-bookmark
				   :name  "Non lus -4 jours"
				   :query "date:4d..today and flags:unread"
				   :key ?d))

	(setq
	 message-send-mail-function   'smtpmail-send-it
	 user-mail-address "Pierre.DEDIEU@rouen.fr"
	 smtpmail-default-smtp-server "mail.rouen.fr"
	 smtpmail-smtp-server         "mail.rouen.fr"
	 smtp-mail-service 587
	 smtpmail-local-domain        "rouen.fr"
	 smtmail-stream-type 'starttls
	 starttls-use-gnutls t
	 user-full-name  "Pierre DEDIEU"
	 mu4e-compose-signature
	 (concat
	  "Pierre DEDIEU\n"
	  "Mairie de Rouen\n"
	  "DSI - SOI - Infrastructures et Production\n"
	  "Responsable Production et Architecture\n"
	  "DSI - Production\n\n"
	  "T√©l√©phone: 02 35 08 86 37\n"
	  "Courriel: pdedieu@rouen.fr\n\n"
	  "Mairie de Rouen\n"
	  "Place du G√©n√©ral de Gaule\n"
	  "76037 ROUEN cedex 1\n\n"
	  "√âconomisez du papier, n'imprimez ce message que si n√©cessaire\n"
	  "Soyons √©cocitoyens!")
	 mu4e-headers-fields '((:human-date . 12)
	  (:flags . 6)
	  (:from-or-to . 26)
	  (:size . 8)
	  (:subject)))
	;; spell check
	(add-hook 'mu4e-compose-mode-hook
		  (defun my-do-compose-stuff ()
		    "My settings for message composition."
		    (set-fill-column 72)
		    (flyspell-mode)))
      #+END_SRC
    - Configurer l'authentification sur le serveur Exchange
      - Utiliser SeaHorse (MDP, ubuntu graphique)
      - Se cr√©er une clef PGP /GPG moi pour MangeChats
      - lancer emacs en mode graphique pour que seahorse puise
	intercepter la demande de clef
      - saisir la passphrase dans seahorse en l'enregistrant
      - Se cr√©er dans emacs un fichier *~/.authinfo.gpg* avec comme
	contenu crypt√© ~mail.rouen.fr 587 Pierre.Dedieu MonMotDePasse~
      - Je m'ajoute un alias dans *~/.profile* soit ~max='emacs
	~/.emacs.d/init.el -f mu4e '~
      - Pour la correction avec flyspell-mode on peut utiliser *C-M-I*
	qui prend le premier choix et peut √™tre appel√© plusieurs fois
	pour les alternatives. Il est aussi possible de choisir les
	possibilit√©s par num√©ro *M-$* ou *Escape-$*
      
*** Quelques raccourcis clavier
    - O :: Permet de changer le champ selon lequel est filtr√© la liste
           des msg
    - H :: Affiche l'aide info du module
    - W :: Bascule l'affichage des mails de la conversation ou
           seulement de ceux qui matchent
    - ] :: Prochain message non lu (*[* pour pr√©c√©dent
    - n/p :: mail suivant / pr√©c√©dent
    - s :: saisie d'un filtre de recherche (*S* pour √©diter le courant)
    - / :: affiner la recherche actuelle (backslash pour revenir)
    - H :: affiche l'aide (info) sur le mode
    - r :: Refill (applique le d√©placement selon les r√®gles d√©finies
           pour le message)
    - e :: Dans un message, Extract l'une des PJ
	  
*** Filtre de recherche avec mu
    - La documentation la plus compl√®te est dans *man mu-find*
    - Il faut taper *s* puis taper une query
    - *S* permet de modifier la requ√™te courante
    - Quelques exemples:
      - from:dedieu date:today subject:Oracle not g:seen 'MotClef √†' :: penser
           √† entourer une s√©quence par des ' si il faut des espaces
      - to:monnier and not flag:seen cron :: noter que le nom est
           incomplet et que si on utilise une * elle ne peux √™tre
      - date:2y..1m size:1k..200m m:Procedures:: filtre par date et taille
      - pour selectionner par dossier utiliser *jo* et taper quelques
	lettres du nom de dossier (incr√©mental). Sinon voir que des
	regex peuvet √™tre pr√©cis√©es encadr√©es par des /.
      - pour rechercher un tag c'est tag:XXX
       
** Gestion des mails notmuch - Free/GMail
*** Installation
    - paquet offlineimap sous linux (dnf ou apt)
    - configuration dans ~~/.offlineimaprc~
      #+begin_example
[general]
accounts = MangeChats, Free

[Account MangeChats]
localrepository = Local
remoterepository = Remote

[Repository Local]
type = GmailMaildir
localfolders = ~/mail/Gmail

[Repository Remote]
type = Gmail
remotehost = imap.gmail.com
remoteuser = XXXXX@gmail.com
remotepass = VotrePasswordDeGMail
ssl = yes
starttls = no
sslcacertfile = /etc/ssl/certs/ca-certificates.crt
# Voir https://console.cloud.google.com/apis/credentials?inv=1&invt=AbiUlQ&project=jovial-acronym-727 et d√©finir une application web
#  avec comme URI de redirection https://oauth2.dance/    
oauth2_client_id = XXXXXX.googleusercontent.com
oauth2_client_secret = XXXXXXXXX
# Utiliser git clone https://github.com/google/gmail-oauth2-tools
#  puis lancer
#  python oauth2.py --generate_oauth2_token --client_id=XXXXXXXXXXX.apps.googleusercontent.com --client_secret=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
#  passer le warning et copier le refresh_token obtenu
oauth2_refresh_token = XXXXXXXXX

[Account Free]
localrepository = Local-Free
remoterepository = Remote-Free

[Repository Local-Free]
type = Maildir
localfolders = ~/mail/Free

[Repository Remote-Free]
type = IMAP
remotehost = imap.free.fr
remoteuser = XXXXXX@free.fr
remotepass = XXXXXX
ssl = yes
starttls = no
sslcacertfile = /etc/ssl/certs/ca-certificates.crt
      #+end_example
    - lancer une premi√®re fois un ~offlineimap setup~
    - puis r√©cup de la boite en local par ~offlineimap new~
    - Installer le paquet notmuch sous linux (dnf ou apt)
    - L'installer aussi dans emacs (package-list-packages)
    - Installer le package ~bbdb~ pour g√©rer la base des contacts
    - Se d√©finir un mot de passe d'application dans son compte Google
      - Dans Gmail cliquer en haut √† droite sur l'ic√¥ne du compte,
        puis sur *G√©rer votre compte Google*
      - Rechercher *app* pour avoir l'√©cran Mot de passe des application
      - Donner un nom d'application (emacs-mail ?) puis bouton *Cr√©er*
      - Copier le mot de passe g√©n√©r√© par Google et le coller dans votre *~/.authinfo* ou plut√¥t *~/.authinfo.gpg*
      - la nouvelle ligne sera du type
	~machine smtp.gmail.com login MangeChats password blbablabla~
      - Attention il faut retirer les espaces du mot de passe fourni par Google
    - Configurer notmuch et l'envoi de mails dans default.el ou .emacs
      #+begin_src elisp
	(setq mail-user-agent 'message-user-agent)
	(setq user-mail-address "MangeChats@gmail.com"
	      user-full-name "Pierre DEDIEU")
	;; smtp config
	(setq smtpmail-smtp-server "smtp.gmail.com"
	      message-send-mail-function 'message-smtpmail-send-it)
	;; report problems with the smtp server
	(setq smtpmail-debug-info t)
	;; add Cc and Bcc headers to the message buffer
	(setq message-default-mail-headers "Cc: \nBcc: \n")
	;; postponed message is put in the following draft directory
	(setq message-auto-save-directory "~/mail/draft")
	(setq message-kill-buffer-on-exit t)
	;; change the directory to store the sent mail
	(setq message-directory "~/mail/")
	(defun notmuch-remove-deleted ()
	  "Efface les messages tagg√©s deleted"
	  (interactive)
	  (shell-command "notmuch search --output=files tag:deleted | tr '\\n' '\\0' | xargs -0 -L 1 rm")
	  (sleep-for 0.3)
	  (notmuch-poll-and-refresh-this-buffer)
	  )
	(defun notmuch-exec-offlineimap ()
	    "execute offlineimap pour syncho mails locaux et serveurs"
	    (interactive)
	    (set-process-sentinel
	     (start-process-shell-command "offlineimap"
					  "*offlineimap*"
					  "offlineimap -o")
	     '(lambda (process event)
		(notmuch-refresh-all-buffers)
		(let ((w (get-buffer-window "*offlineimap*")))
		  (when w
		    (with-selected-window w (recenter (window-end)))))))
	    (popwin:display-buffer "*offlineimap*"))
	(add-to-list 'popwin:special-display-config
		     '("*offlineimap*" :dedicated t :position bottom :stick t
		       :height 0.4 :noselect t))
	(defun notmuch-tag-large-mails (taille)
	  "Contourne l'absence de notion de taille dans notmuch la taille en param√®tre"
	  (interactive "nTaille max en Mega octets: ")
	  (let ((cmd (format "for msg in $(
	  for file in $(find ~/mail/ -type f -size +%sM);
	    do
	      grep -i ^Message-Id $file | sed -e \"s/^.*<\\(.*\\)>.*/\\1/\";
	    done
	    );
	      do
		notmuch tag +large id:$msg;
	      done"
			     taille)))
	    ;;(message cmd)
	    (shell-command cmd)
	    (notmuch-search "tag:large")
	    (delete-other-windows)
	  ))
	;; Pour les envois:
	(setq user-mail-address "MangeChats@gmail.com"
	      user-full-name "Pierre DEDIEU")
	(setq mail-user-agent 'message-user-agent)
	(setq message-send-mail-function 'smtpmail-send-it
	      smtpmail-stream-type 'starttls
	      smtpmail-smtp-server "smtp.gmail.com"
	      smtpmail-smtp-service 587)
      #+end_src
*** Utilisation
    - lancement par ~notmuch-hello~ (ou d√©finir un raccourci clavier)
    - Tous les mails sont dans une seule base, et le principe est de
      faire des requ√™tes voir de positionner un pour plusieurs tags
      sur les messages, puis de cr√©er des queries (similaires √† des
      dossier virtuels)
    - Les derni√®res requ√™tes sont conserv√©es √† l'√©cran d'accueil et
      elles peuvent √™tre sauv√©es pour les prochaines sessions
    - les commandes sont (pense √† TAB pour completion)
    - s :: Search, saisie d'une query
      - E :: Edit, modifier la requ√™te dont le r√©sultat est affich√©
      - j :: Jump, lancer une query par d√©faut ou sauv√©e par
	l'utilisateur (choix dans une liste)
      - o :: revert list Order
      - Z :: tree view of current list
      - l :: Limit, filtre la liste par une requ√™te compl√©mentaire
      - +/- :: ajoute/retire un tag pour le mail courant ou la s√©lection (C-space)
      - * +/- :: ajoute ou retire des tags aux mails de la liste en cours
      - m :: √©crire un Mail
      - r :: Reply (*R* rplay-all)
      - q :: Quit, retour √† hello depuis une liste de r√©sultats¬≤
    - Mots clefs pour les recherches:
      - from: / to: :: Exp√©diteur ou Destinataire
      - date: start..send :: s√©lection entre start et end (et on peut
        omettre start ou end), qui peuvent s'√©crire
	- en absolu avec HH:MM ou MM/YYYY ou DD/MM/YYYY
	- en relatif avec *nnM* pour nn mois avant aujoud'hui, *nnd*
          pour nn jours, voir *two weeks*
      - subject: :: suivi d'un mot ou d'une regex
	- ex: subject:/[qQ]antum/) le mot peut inclure *** sinon ce
          sera le mot complet
      - body: :: idem pour le corps du mail
      - tag: :: un des tags d√©finis par l'utilisateur ou par d√©faut
        (√©quivallent √† is: ?)
	- tag:attachment :: pour s√©lectionner les mails ayant une pi√®ce jointe
      - attachment:  :: pour rechercher un mail avec une pi√®ce jointe
        dont le nom commence par (supporte aussi une regex avec ~/regex/~)
    - Joindre des crit√®res avec *and*, *or*, *not*
      - plus sp√©cifique *NEAR* ou *ADJ** entre deux mots pour que les
        2 soient √† moins de 10 mots
    - Exemples
      - from:Dedieu and subject:internet :: mails de Pierre DEDIEU
        comme de pierre.dedieu, dont le sujet contient Internet ou
        internet ou INTERNET (les recherche sont case insensitives)
      - from:dedieu and not from:pierre :: mails des Dedieu hormis Pierre
      - from:dedieu and maison :: mails des Dedieu contenant maison
        (sujet, contenu ou autre)
      - date: 3w.. :: mails des trois derni√®res semaines
      - folder:"/.*/Trash$/" :: ceux qui sont dans la poubelle de gmail
      - date:10/2018..12/2018 and to:dedieu and from:dedieu ::
	re√ßu entre octobre et d√©cembre 2018 envoy√© par dedieu et √†
        destination de dedieu
	
* Macros
  Enregistrer avec *F3* puis fin par *F4*, ex√©cution via *F4* avec
  pr√©fixe par *C-u NN* ou *M-NN* pour r√©p√©ter une macro (peut √™tre
  appliqu√© pour toute autre commande). Fonction avanc√©es via *C-x
  C-k*, noter qu'on peut appeler une des autres commande juste apr√®s
  sans retaper ce pr√©fixe.
  - e :: pour √©diter la derni√®re macro en clair.
  - C-e :: pour √©diter une macro choisie par son binding ou son nom
  - n :: name last kbd macro
  - r :: region, applique une macro √† la r√©gion
  - l :: lossage, √©dition des 300 derni√®res frappes comme macro
  - b :: bind, pour associer √† une touche.
  - C-n/C-p :: next/previous, affichage des diff√©rentes macros ring.
  Apr√®s l'avoir renomm√©e, on peut ins√©rer le code lisp d'une macro
  dans le fichier de conf via *M-x insert-kbd-macro* pour la retrouver
  lors de prochaines sessions (*C-u M-x insert-kbd-macro* pour ins√©rer
  en plus l'assignation de touches).

  L'alternative est *C-x (* pour commencer une macro et *C-x )* et
  *C-x e* pour l'ex√©cuter. *e* permet ensuite de r√©p√©ter la macro. Il
  est possible aussi de demander NN √©x√©cutions avec *C-u NN C-x e* ou
  *ESC NN C-x e*.

  Noter qu'on peut utiliser un compteur pour ins√©rer une valeur qui
  s'incr√©mente dans le contenu de la macro, au moment ou on doit
  placer la valeur, taper *F3*. Par d√©faut la valeur commence √† 0.

  *C-u NNN F3* pour que le compteur soit incr√©ment√© de NNN √† chaque
  it√©ration.

  *M-x edit-last-kbd-macro* permet de voir/modifier la derni√®re
  macro. Finir avec *C-c C-c*

  Il est possible d'ins√©rer le contenu d'une variable dans une macro
  en utilisant ~C-u M-: nom-variable~

* Programmation et debug
** Debug de Bash
  - installer *bashdb* (apt-get ou rpm)
  - Installer via MELPA *realgud* pour disposer de *bashdb* dans emacs.
  - ajouter dans son *.emacs* une ligne *(require 'realgud)*
  - depuis un script shell, *M-x bashdb* lance le debug du script. La
    position courante dans le script est affich√©e avec un triangle en
    d√©but de ligne. Le source est en lecture seule sauf si on termine
    le debug (avec *k*)
  - On peut cliquer devant une ligne du src pour y d√©finir un
    breakpoint, un deuxi√®me clic l'enl√®ve (mais il y reste une trace
    persistante dans l'affichage: bug ?)
  - Les commandes disponibles incluent:
    - n :: pour pas √† pas
    - display nomvar :: pour afficher la variable nomvar (sans le
         $ final) lors de chaque arr√™t du debugger.
    - c :: continue, pour ex√©cuter le script jusqu'au prochain
         breakpoint ou √† la fin
    - R :: Restart, reprend le debug au d√©but du script
    - b NN :: d√©finir un breakpoint √† la ligne NN (on peut pr√©ciser
         une condition pour ne s'arr√™ter que si elle est remplie).
    - action NN comande :: ajoute une action (bash) √† ex√©cuter lors de
         chaque arr√™t du debugger. ¬µPb je ne sais pas effacer une
         action sans quitter le debugger !
    - pr $var :: Print de la valeur de $a.
    - x $a :: eXamine, proche de print mais sait g√©rer des liste des
         fonctions ...
    - L :: affiche breakpoints, watch, actions d√©finies
    - info display :: affiche les displays d√©finis
    - undisplay NN :: supprime un display
		      
** Debug de C et C++
  - Penser √† compiler en debug , soit pour un seul fichier *M-x
    compile* en choisissant *gcc -g %*
  - Noter que pour se positionner sur la prochainee erreur de
    compilation on peut utiliser *M-g n*
  - Autre options de compilation utilis√©es
    - -o nomprogramme :: pour forcer le nom du programme (sinon a.out)
    - -WAll :: tous les warnings
  - En standard sur emacs, *M-x gdb*
  - *r* pour lancer le programme
  - *b main* pour mettre un point d'arr√™t au d√©but de la fonction
    main(), on peut aussi pr√©ciser le no de ligne. On peut ajouter une
    condition en ajoutant *if condition*
  - condition bnum cond :: modifie la condition du breakpoint (voir
       *info b* pour connaitre les bnum)
  - *C-c C-c* pour l'interrompre
  - *display NomVar* pour afficher √† chaque arr√™t le contenu d'une
    variable (*p NomVar* l'affiche une seule fois).
  - le *clic* devant une ligne en C y place un point d'arr√™t, un nouveau
    l'enl√®ve.
  - le *Ctrl-clic* devant une ligne en C permet de d√©sactiver /
    r√©activer le point d'arr√™t.
  - *M-x speedbar* pour l'acc√®s direct aux fonctions et structures.
  - En GDB on y trouve l'affichage des watchs, qu'on cr√©e avec *C-x C-a
    C-w* (sur la variable, ou *C-u C-x C-a
    C-w* pour la saisir)
    
*** Indentation et styles
    Au del√† du programme externe *indent* qui est plus pram√©trale,
    dans un source en c-mode
    - C-c . :: choisir le style d'indentation (TAB pour afficher les
               choix tels stroustrup, gnu, k&r, linux, bsd ...)
    - C-x h C-M-\ :: S√©lectionne tout le buffer et formate avec le
                     style courant.

** Python
  - C-c C-z :: switch to python shell (si pas lanc√©, utiliser *C-c
               C-p*)
  - C-c C-c :: send current Buffer to python shell, donc execute le
               programme si on est dans le module principale.
  - C-c > :: indente la r√©gion s√©lectionn√©e
  - C-c < :: d√©sindente la r√©gion s√©lectionn√©e
  - M-. :: Recherche de la d√©finition d'une variable ou fonction
    - doit √™tre pr√©c√©d√© par une √©tape de g√©n√©ration des TAGS our le
      r√©pertoire et les sous-r√©pertoires concern√©s
      #+begin_src bash
      find . -type f -name '*.py' | xargs etags
      #+end_src
    - pour un simple r√©pertoire, voir ~M-x compile RET etags *.py~

  - Voir *PyCharm* comme IDE Python

*** Debug
  - Ajouter ~import pdb; set_trace();~ dans un code pour y placer un
    point d'arr√™t. En python 3.7 mini on peut faire ~breakpoint()~
    - Noter que si on d√©fini dans le programme ~PYTHONBREAKPOINT=0~ les
      appels √† breakpoint() sont ignor√©s
  - M-x pdb :: Permet de lancer le programme dans le debugger, ma
               s√©quence type est (dans la fen√™tre pdb):
    - b N , condition :: ajouter un breakpoint confitionnel √† la ligne
         *N* (ou *b nom-module:N* pour autre fichier)
    - b nom_fonction :: est une alternative pour arr√™ter √† l'entr√©e de
      la fonction, et la version compl√®te est ~b fichier.nom_fonction~
    - r :: run pour lancer le programme jusqu'au retour de la fonction
      courante
    - disable / enable bp :: pour d√©sactiver temporairement
    - ignore bp NN :: le BP ne s'active qu'au bout de NN passage
    - condition bp :: mettre une nouvelle condition au bp
    - commands bp ::  taper une liste de cmd pdb √† faire lors de
      l'arr√™t (finit par ~end~)
    - c :: continue jusqu'au prochain bp
    - p var :: affichage de la variable
    - pp var :: pretty print affichage multiligne pour les
      dictionnaires ou autre structures
    - whatis expression :: affiche le type de expression
    - display expression :: affiche la valeur de l'expression √† chaque
      arr√™t (retirer avec ~undisplay exp~)
    - l . :: affiche source autour du point
    - a :: affichage des param√®tres de la fonction courante
  - customize :: rechercher *pdb* et remplacer si n√©cessaire *Gud pdb
                 command name* par le chemin complet */usr/bin/pdb3*
  - pdb depuis le buffer source ::
    - F10 :: next, avance d'une ligne
    - F11 :: step, idem mais entre dans les sous programmes
    - F5 :: continue
    - F12 :: break
    - clic sur 1i√®re colonne d'une ligne :: ajout d'un breakpoint
  - Alternative ~realgud~ et 

*** Pony-mode
   - installable via *package-list-package*, puis d√©finie un
     *pony-mode* √† tester pour lancer le serveur et plus. Je note
     qu'il est dispo de base sur Spacemacs MAIS ne fonctionne pas sur
     mon PC:
     - Semble se faire en ouvrant le fichier settings.py, mais
       n'arrive pas √† retrouver le r√©pertoire racine du projet, ou le
       pythonpath... mes essais ont tous √©chou√©s.
     - n√©cessite de forcer l'interpr√©teur python √† /usr/bin/python3
     - n'arrive pas √† utiliser le .ponyrc pour sp√©cifier les infos du projet
   - La lecture de pony.el et la page [[https://marmalade-repo.org/packages/pony-mode][d'un blog]] me donnent une piste pour
     comprendre l'√©chec du lancement du serveur par pony: malgr√© un customize
     qui pr√©cise d'utiliser python3... c'est toujours python 2.7. Il semble que
     la cr√©ation d'un fichier *.ponyrc* dans le r√©pertoire root du projet, soit
     le r√©pertoire de manage.py, avec comme contenu:
     #+BEGIN_SRC emacs-lisp
       ;; Pony mode config for my project
       (make-pony-project
	:python "/usr/bin/python3")
     #+END_SRC

*** python-django
   - Installer le package via *list-package* et MELPA.
   - Apr√®s installation, utiliser *python-django-open-project* que
     j'ai assign√© sur Tosh √† *C-c C-g*
   - cette fonction fait r√©f√©rence √† un *trouve.settings* qu'il faudrait
     d√©finir
   - De nombreux raccourcis dans la fen√™tre obtenue:
     - crr :: pour lancer le serveur
     - t :: pour reconstruire les tags (le fichier TAGS est √† la
            racine du projet)
     - F10 :: voir le menu puis *Django* pour rappeler qq raccourcis
   - voir la [[file:~/Documents/Django/retrouve/django-documentation.org][doc de retrouve]]

** Perl
   - M-x perldb :: lance le debugger sur le source perl du buffer en cours
     - n :: next, ex√©cute une ligne et se place sur la suivante
     - s :: step, ex√©cute une action √©l√©mentaire (entre si besoin dans
            une fonction)
     - { commande :: d√©fini une commande √† lancer avant chaque retour
                     au prompt (penser √† finir par ;)
     - {{ commande :: ajoute une commande √† lancer avant chaque retour au prompt
     - { ? :: affiche les action d√©finies
     - { * :: efface les actions
     - x var :: affiche le contenu d'un tableau ou d'un hash
     - p var :: affiche une variable
     - b N if (condition) :: pose un point d'arr√™t conditionnel √† la ligne N.
       
** elpy pour les programmes python
*** Installation
   - Voir le package elpy
   - Voir l'utilisation sur [[https://github.com/jorgenschaefer/elpy/wiki/Installation][une page sur l'init]]
   - Voir pdf [[https://media.readthedocs.org/pdf/elpy/latest/elpy.pdf][de documentation]] et peut-√™tre [[http://onthecode.com/post/78817537628/emacs-on-steroids-for-python-elpy-el][un survol]] voir ~elpy-mode~.
   - ~elpy-config~ permet de faire un point sur la config. Il semble
     manquer un backend, rope par exemple via ~pip install --user rope~
   - l'IDE est surtout tatasse dans ses suggestions, comme celles
     concernant la longueur maxi des lignes (voir √† changer le
     param√®tre pour augmenter la limite ?). Pour valider les modifs et
     voir les suggestions qui restent, surtout si des lignes ont √©t√©
     ajout√©es, sauver le fichier.
     
*** Utilisation
   - C-c C-n :: se positionner sur la suggestion suivante
   - C-c C-p :: se positionner sur la suggestion pr√©c√©dente.
   - M-X ~elpy_mode~ :: pour activer / d√©sactiver elpy
   - Esc-TAB :: completion auto de elpy
   - import :: elpy n'aime pas les ~import *~ il faut lister les
               objets qui sont utilis√©s (la compl√©tion y aide, elle
               propose les objets existants dans l'import).
** java
  - jde devenu jdee : pas trouv√© par ou le configurer
  - peut √™tre https://github.com/iocanel/idee
  - un package jetbrain bridge vers l'ide plus classique ??
  - une d√©mache appuy√©e sur eclipse !
    http://www.goldsborough.me/emacs,/java/2016/02/24/22-54-16-setting_up_emacs_for_java_development/
  - emacs lsp-java ???
    https://xpressrazor.wordpress.com/2020/11/04/java-programming-in-emacs/
** eLISP
  Noter que pour common lisp les sp√©cificit√©s sont dans [[file:CommonLisp.org][un fichier d√©di√©]]
  - C-h-v :: pour afficher le contenu d'une variable
  - C-M-x :: pour ex√©cuter l'expression dans laquelle se trouve le point
  - M-: :: pour √©valuer l'expression tap√©e dans le minibuffer
  - C-x e :: Exec, permet d'ex√©cuter l'expression imm√©diatement avant
    le curseur (en particulier dans scratch).
  - C-j :: ins√©re en plus le retour dans le buffer (pas en std ?)
  - (interactive) :: dans une fonction *defun*, permet de la rendre
                     accessible avec *M-x*
    - (message "Voici %d raisons d'√©crire du lisp %s" (+ 1 1) "WhiteHat")
    - Un message ainsi envoy√© appara√Æt dans la statusbar, mais on peut trouver
      l'historique des messages avec *C-h e* dont on peut sortir par *q*.
    - noter qu'on peut d√©finir des param√®tres avec prompt dans une string
      type ~(interactive "sServeur: \nsChemin: ")~
      #+begin_src elisp
	(defun my-dired (srv chemin)
	"Essai d'ouverture d'un r√©pertoire distant avec adminpdedieu
	 via tramp, yubikey et sudo"
	(interactive "sServeur: \nsChemin: ")
	(find-file
	 (format "/ssh:adminpdedieu@%s.intranet.rouen.fr|sudo:%s.intranet.rouen.fr:%s"
		 srv
		 srv
		 chemin)))
      #+end_src
  - C-M i :: Completion du mot commenc√© (variable, fonction ...)
  - C-u C-M x :: instrumenter la fonction autour du point, qui permet
    d'y mettre un point d'arr√™t via *b*. l'appel de la fonction
    instrument√©e fait arr√™ter le debug √† son entr√©e.
    - Le debug peut se faire avec
      - n ou SPC :: pour next,
      - h :: here pour continuer jusqu'√† la s-ex du curseur
      - b :: breakpoint, pour poser un breakpoint
      - g :: go jusqu'au prochain breakpoint (*G* pour finir le debug)
      - i :: into pour faire du pas √† pas dans la fonction en cours
      - e :: eval
      - d :: display backtrace
      - ? :: aide
  - Noter que j'ai pu planter emacs et *C-x e* retournait
    r√©guli√®rement *no inferior list process* (seul la sortie d'emacs a
    permis la correction)
  - paredit-mode :: un package optionnel, qui permet la saisie
    automatique de la deuxi√®me parenth√®se (voir Commmon-Lisp.org)
    - C-M Space :: s√©lectionne la sexp courante
    - C-M-e :: Se place √† la fin du defun courant (pratique avant C-x
      e pour la recompiler
    - C-k :: efface jusqu'√† la fin de ligne, sauf si elle contient des
      fins d'expressions commenc√©es avant le point
    - M-/ :: complete le symbole commenc√©, y compris avec des noms d√©j√† pr√©sents dans le fichier
  - Exemples de code
    #+BEGIN_SRC elisp
      (defun delta(a b c)
      "Retourne le discriminant de l'√©quation ax2+bx+c=0"
      (-
       (* b b)
       (* 4 a c)))

      (defun degre2(a b c)
	"Retourne les deux racines de l'√©quation ax2+bx+c=0"
	(let ((del (delta a b c))
	      (den (* 2 a)))
	  (list
	   (/ (+ (- b) (sqrt del)) den)
	   (/ (+ b (sqrt del)) den))))

      (defun increment-number-at-point ()
	"incr√©mente l'entier sur lequel se trouve le curseur"
	(interactive)
	(skip-chars-backward "0-9")
	(or (looking-at "[0-9]+")
	    (error "No number at point"))
	(replace-match (number-to-string (1+ (string-to-number (match-string 0))))))
      (global-set-key (kbd "C-c =") 'increment-number-at-point)
     #+END_SRC
    
*** Minor-mode
  Voir Writing GNU Emacs Extensions Chap 7
  - D√©finir une variable locale au buffer *NOM-mode* ~(defvar-local NOM-mode)~
  - D√©finir une fonction pour entrer/sortir du mode
    #+begin_src elisp
      (defun NOM-mode (&optional arg)
	"NOM minor mode"
	(interactive p)
	(setq NOM-mode
	      (if null arg
		(not NOM-mode)
		(> (prefix-numeric-value ar) 0))
	(if NOM-mode
	    ; entr√©e dans le mod
	    ; sortie du mode))     
    #+end_src
  - Ajouter une association √† la alist ~minor-mode-alist~ pour d√©finir
    un indicateur √† afficher dans la modeline genre ~(NOM-mode . " NOM")~
    #+begin_src elisp
      (if (not (assq 'NOM-mode minor-mode-alist))
	  (setq minor-mode-alist
		(cons '(NOM-mode " NOM")
                      minor-mode-alist)))
    #+end_src
*** Major_mode
  Voir Writing GNU Emacs Extensions Chap 9
  
*** Major-mode bas√© sur un mode existant
  Utilisation d'un package d√©di√© pour une macro qui simplifie l'√©criture du mode
  
*** Affichage des macros elisp
    - Package √† installer: *macrostep*
    - fourni le minor-mode *macrostep-mode*
    - quand activ√©
      - e :: expand, permet de remplacer la macro courante par sa valeur
      - c :: collapse, pour revenir √† l'affichage normal
      - q :: pour sortir de ce minor-mode (sinon read-only)
    - les macros elisp se d√©finissent avec ~(defmacro NOM ...)~

*** Fabrication d'epub
**** Actuellement
   installer le package *ox-epub* et apr√®s un ~(require 'ox-epub)~ le
   raccourci *C-c C-e* propose la conversion org en epub
**** Historique
    Dans un premier temps des m√©thodes lisp m'ont √©t√© n√©cessaires
    (gard√©es pour assimiler elisp). Maintenant j'ai trouv√© le package
    *ox-pandoc* qui me simplifie cela, avec la fonction
    *org-pandoc-export-to-epub3*
    
    #+BEGIN_SRC emacs-lisp
      (defun convert-md-2-epub ()
	"Convertion de markdown en epub avec pandoc pour le buffer courant"
	(interactive)
	(let* (
	       (debut (replace-regexp-in-string "\\..*" "" (buffer-file-name)))
	       (cmd (format "pandoc -f markdown -t epub -o %s.epub %s"
			    debut
			    (buffer-file-name))))
	  (message "Yapluka lancer %s" cmd)
	  (shell-command cmd)))
    #+END_SRC
**** Conversions via pandoc sur Apple (org en texte MS Office et epub)
    #+BEGIN_SRC emacs-lisp
      ;; Suite √† disparition export odt, interface √† pandoc ...
      (defun convert-org-to-docx ()
	"Converti le buffer courant en MS-Office Word"
	(interactive)
	(let* ((dest (replace-regexp-in-string "\.org$" ".docx" (buffer-file-name)))
	   (cmd (format "pandoc -f org -t docx %s -o %s" (buffer-file-name) dest)))
	  (shell-command cmd)
	  (message cmd)))
      (defun convert-org-to-epub ()
	"Converti le buffer courant en epub"
	(interactive)
	(let* ((dest (replace-regexp-in-string "\.org$" ".epub" (buffer-file-name)))
	   (cmd (format "pandoc -f org -t epub %s -o %s" (buffer-file-name) dest)))
	  (shell-command cmd)
	  (message cmd)))
    #+END_SRC
    
** Buffer dired ouverts
   Voir assoc ~dired-buffer~ pour une liste en elisp
*** Buffer non associ√© √† un fichier

** SQL et CLI
  - M-x sql-mysql :: Quand on √©dite un fichier SQL, pour pr√©cider le
                     type de variante utilis√©e (interactif pour user,
                     pwd, server)
  - C-c C-z :: fait apparaitre le buffer *SQL* associ√© avec les
               retours des commandes mysql
  - M-x toggle-truncate-line :: Pour √©viter les retours √† la ligne
  - C-c C-c :: Envoyer le paragraphe courant du buffer sql vers le
               prompt
  - C-c C-r :: idem pour la r√©gion s√©lectionn√©e
  - M-x sql-product-interactive :: pour un buffer dont le type SQL
       n'est pas correct
  - En principe on peut corriger une ligne dans la table r√©sultat d'un
    select simple. Mais comment valider la modification ??
    
** TAGS
  Pour indexer et rechercher dans les sources d'un r√©pertoire
  - C-c T :: pour compiler tous les tags dans le r√©pertoire courant
  - M-. :: pour rechercher le mot sous le curseur
  - M-* :: pour revenir dans l'historique avant la derni√®re recherche de tag
  - M-x tag-search :: pour rechercher toutes la premi√®re occurrences d'une regexp
  - M-, :: permet de chercher la suivante ...+mail+reader+exchange&t=canonical&ia=qa
	   
** Folding
   - C-c @ C-M-h :: Hide All, plie tous les niveaux
   - C-c @ C-M-s :: Show All, d√©plie tous les niveaux
   - C-c @ C-c :: bascule, le niveau courant
		  
** Docker
   - Pr√©-requis: *docker.io* sur la machine et user dans le groupe
     *docker*
   - Installer via MELPA le package *Docker*
   - Optionnellement ajouter *dockerfile-mode* qui autorise le build
     via *C-c C-b* (depuis le fichier dockerfile, mais il faut passer
     en *dockerfile-mode* avant.
   - M-x docker-images :: liste les images disponibles sur le
        syst√®me. Des commandes via une touche sont disponibles pour
        l'image s√©lectionn√©e, puis *R* lance le run:
     - h :: Aide sur le mode avec la liste des commandes
     - R :: Run popup, permet de lancer un container avec aide √† la
            saisie des param√®tres de *docker run*, les commandes
            disponibles incluent (un historique est dispo avec haut/bas):
       - =m :: pour pr√©ciser le nom de l'image
       - -d :: pour detach
       - =e :: pour ajouter des variables d'environnement comme
               ~CONFIGFILE=configTEST.py~
       - =p :: pour ports, par exemple 8080:80
     - D :: Delete, pour effacement d'une image via pop-up
     - C-x C-s :: permet de sauver les options du run
   - M-x docker-containers :: liste les containers, avec commandes via
        une touche, ma s√©lection:
     - I :: Inspect popup, puis *C* pour afficher la commande compl√®te du run
     - L :: Log, voir les logs du container
     - O :: stOp, arr√™t du container
     - S :: Start, lancer le container (qui doit √™tre stopp√©)
     - b :: Shell sur l'image
     - C :: Copy, choix entre *F* from et *T* to pour copie de fichier
            ou r√©pertoire d'un container vers localhost ou
            r√©ciproquement.
     - D :: Delete, pour supprimer un container (-f possible si il est up)
     - f :: file, ouvre un dired sur les fichier du container, un
            return et on peut les voir et m√™me modifier en live
            (penser si OK √† copier les fichiers modifier dans les
            sources d'origine).
     - R :: Restart du container
	    
** Puppet
   - il existe un *puppet-mode* dispo sur le d√©p√¥t melpa optionnel
   - une fois activ√©, il permet
     - la coloration syntaxique et l'indentation auto (2 espaces)
     - C-c C-a :: alignement des => pour la s√©lection
     - C-M-a / e :: le d√©placement sur la ressource p√©c√©dente / suivante
     - C-c C-l :: v√©rification de syntaxe par puppet-lint (installer
                  via ~apt install puppet-linl~
		  
** Comparaisons
   - M-x ediff :: Apr√®s saisie des deux noms de fichiers, on a deux
                  buffers et une petite fen√™tre de commande.
     - | :: pipe, permet d'afficher les deux buffers verticalement (bascule)
     - n :: permet de se place sur la prochaine diff√©rence (*p* la
            pr√©c√©dente)
     - a :: copie la diff√©rence de A vers B
     - b :: copie la diff√©rence de B vers A
     - v et V :: scroll les deux buffers (vers le bas / haut)
     - < et > :: scroll les deux buffers (vers la gauche / droite)
   - C-x sd :: permet d'afficher les diff√©rences des buffers ouverts avec
               leurs fichiers (puis de choisir de les sauvegarder ou pas)
   - M-x ediff-current-buffer :: est une alternative √† la commande
	pr√©c√©dente, mieux pr√©sent√© et c'est du ediff, voir son
	fonctionnement.
   - M-x ediff-compare-directories :: Lance une comparaison de deux
	r√©pertoires, taper ensuite *D* pour afficher les diff√©rences,
	voir copier les fichiers qui seraient d'un seul c√¥t√© via *C*
	(demande une confirmation).
   - M-x ediff-current-buffer :: Pour comparer le buffer courant avec
     son fichier (avant de sauver, quelles sont les diff√©rences ?)
       
** Suivi des versions de sources
*** Int√©gration dans emacs
     Suivi des modification du fichier en cours (bzr par exemple ... mais marche avec git)
     - C-x vv :: Next action de Version Control (enreg new file, new version ...)
     - C-x vl :: Log de Version Control pour un fichier
       - = :: Pour voir les diff√©rences amen√©e par cette version
       - n p :: next/previous message
       - < > :: d√©but/fin du buffer
       - g :: revert buffer (rafra√Æchi son √©tat)
       - e :: edit change comment
       - q :: quit
     - C-x vd :: Version Control pour un r√©pertoire (edited/registered ...)
       - L :: log de toutes les modifs. Pour chaque ligne *=* permet de
	      voir les modifs du fichier concern√©
       - Return :: pour afficher le fichier
       - o :: Visit file in other window
       - v :: pour next-action sur la ligne courante (ou les s√©lections)
       - = :: pour afficher ce qui a chang√© sur un fichier (edited !)
	 - n :: pour se placer sur la prochaine diff√©rence
	 - p :: pour se placer sur la pr√©c√©dente diff√©rence
       - l :: log (voir les diff√©rent logs du fichier)
       - m :: Mark pour s√©lectionner un fichier (M tous les fichiers dans le m√™me √©tat que le courant)
       - u :: Unmark pour d√©-s√©lectionner le fichier (U pour tous les fichiers dans le m√™me √©tat que le courant)
       - P :: Push, mais √©choue si on n'a pas stock√© dans la config du
	      r√©pertoire courant de git le username/password. Soit dans le fichier .git/config
	      #+BEGIN_EXAMPLE
	      [remote "origin"]
	      url = http://pdedieu:XXXXXXX@hdvgen15.intranet.rouen.fr/pdedieu/IKV.git
	      #+END_EXAMPLE
       - q :: pour sortir de vc-dir
     - M-x vc-version-diff :: diff√©rences entre deux r√©visions pour un
       fichier (voir si int√©ressant par rapport √† *l --*)
     - Pour utiliser ediff comme mergetool :: le choix n'existe pas
	  sauf √† ajouter dans *~/.gitconfig*
	  #+BEGIN_EXAMPLE
	  [mergetool "ediff"]
	  cmd = emacs --eval "(ediff-merge-files-with-ancestor \"$LOCAL\" \"$REMOTE\" \"$BASE\" nil \"$MERGED\")"
	  #+END_EXAMPLE
	  et il est alors possible d'utiliser *git mergetool -t ediff FILE*
     - Suggestions de config Git:
       #+begin_src bash
       git config --global pull.rebase true
       git config --global fetch.prune true
       git config --global diff.colorMoved zebra
       #+end_src
*** magit
    - Installation via ~package-list-packages~
    - commande initial ~magit-status~ (C-x g)
      - si le r√©pertoire n'est pas encore un projet git (pas de sous-dossier .git)
	- propose de le cr√©er
	- pour ajouter le remote gitlab.rouen.fr utiliser *Ma* chez nous
          le nommer *rouen* et donner l'URL du projet PREALABLEMENT cr√©√©
          dans giltab (sans Readme par d√©faut svp, le cr√©er dans notre rep local si besoin)
	- propose d'en faire le remote.pushDefault par d√©faut: bonne id√©e
    - Commencer par d√©finir une nouvelle branche pour y inclure les
      modifications envisag√©es (en g√©n√©rale bas√©e sur dev)
    - Une fois valid√©es les modifications, les merger avec la branche
      d'origine. Pour cela se placer sur la destination et merger la
      branche plus avanc√©e
    - Commandes:
      - g :: refresh
      - ? :: aide sur les commandes disponibles (contextuelle)
      - TAB :: pour √©tendre/reduire la section courante
      - bl :: pour se placer sur une autre branche locale
      - bc :: pour cr√©er une nouvelle branche et faire un checkout
      - lL :: graphe des branches locales
      - l -- ::  Voir les modifications d'un fichier particulier du
        projet (apr√®s *--* le nom du fichier est demand√©, saisie avec
        auto completion)
      - s :: Stage, pour ajouter les modifications d'un fichier
        existant au prochaine commit. Noter que si utilis√© dans la
        section *Untracked files*, cela permet d'ajouter un fichier ou
        un r√©pertoire au GIT lors du prochain commit.  Il est aussi
        possible de ne *stager qu'une partie des modifications* d'un
        fichier (selectionner via ~C-SPACE~ et fl√®ches dans la liste des
        modifications, avant d'utiliser ~s~)
      - zz :: Creation d'un stash, qui permet de mettre en boite les
        modifs unstaged. N√©cessaire si on veut changer de branche avec
        des modifs en attente de commit
      - cc :: Commit (pousse les modifications staged sur le d√©p local
	pour la branche courante)
      - M a :: ajouter un remote (demande un nom et une URL
      - Pu :: Push de la branche locale vers le GIT distant (pour
	Rouen, ouvrir le VPN avant)
    - La section *unmerged into* liste des modifications disponibles
      dans le d√©p√¥t local et pas sur un distant (il manque un push
      pour r√©gulariser)
      - Voir comment est d√©termin√© le remote sur lequel on alerte
        (quand il y en a deux je ne maitrise pas lequel est notifi√©)
      
*** Pr√©paration du projet sur git
   Issu de la doc IKV
   - Il faut installer le paquet git.
   - Avant de d√©finir un d√©pot, il vous faut d√©finir un *utilisateur*,
     soit ~git config --global user.name "Pierre DEDIEU"~ et ~git
     config --global user.email pdedieu@rouen.fr~
   - Se placer dans le r√©pertoire de l'application √† pousser
   - Optionnellement, cr√©er un fichier ~.gitignore~ avec les noms des
     fichiers √† ignorer (... avec des commentaires commen√ßant par
     #). En fait il existe un *.git/info/exclude* qui semble avoir
     ce but et est cr√©√© par le ~git init~.
   - *Cr√©er le d√©p√¥t* git local via ~git init~
   - Pour ajouter tout *l'ensemble du r√©pertoire* courant dans le d√©p√¥t
     local: ~git add .~ (. peut √™tre remplac√© par le nom d'un fichier)
   - Par d√©faut cela cr√©e une seule branche *master*
   - Il peut √™tre int√©ressant de mettre en place deux branches, pour
     moi *develop* via ~git checkout -b develop~
   - Le *passage d'une branche √† l'autre* se fait via ~git checkout nombranche~
   - Pour incorporer les modifs de la branche dev dans la branche
     master, se placer dans la branche master (~checkout master~) et
     incorporer les modifs avec ~git merge develop --no-ff~ voir man
     git-merge.
   - Pour pousser le git local *sur un serveur*, et dans le cas du
     d√©p√¥t GitLab de la mairie (cr√©er le projet IKV sur l'interface web
     avant), il faut
     - D√©finir la destination par ~git remote add origin
       http://hdvgen15.intranet.rouen.fr/pdedieu/IKV.git~
     - Envoyer le contenu de prod par ~git push origin master~ (en
       √©tant en checkout master)
     - Envoyer le contenu de dev par ~git push origin develop~ (en √©tant en
       checkout develop)
   - Pour r√©cup√©rer le contenu du git sur une *autre machine*, faire
     dans un r√©pertoire vide (pas trouv√© comment √©viter que ce
     r√©pertoire contienne le sous r√©pertoire IKV du projet, √† d√©faut je
     d√©place le r√©pertorie apr√®s coup) ~git clone
     http://hdvgen15.intranet.rouen.fr/pdedieu/IKV.git~
   - Depuis une machine pour MAJ la branch courante avec un des
     contenus distants, ~git pull origin master~
   - Apr√®s une s√©rie de modifs sur le git local en dev, pour les d√©poser sur le
     serveur (si branche dev s√©lectionn√©e en local) ~git push origin develop~
   - Pour enregistrer les modifications du r√©pertoire dans le git ~git
     commit -m "ma description" -a~. Si c'est d'un seul fichier,
     remplacer -a par le nom du fichier. Dans le cas d'emacs apr√®s
     sauvegarde, *C-x vv* fait le commit du fichier, avec saisie du
     message dans un buffer dynamique (valid√© par *C-c C-c*.)
   - Pour travailler avec de multiples branch, s'inspirer des
     explications de [[https://git-scm.com/book/en/v2/Git-Branching-Basic-Branching-and-Merging][ce site]]
     - git peut afficher l'√©tat des diff√©rentes branches du projet et
       les commits: ~git log --all --decorate --oneline --graph~
   - Deux branches sont utilis√©es: master pour la prod et develop pour les
     version pre-prod.
     - pour supprimer les branches mortes distantes list√©es par
       ~git branch -r~
       - ~git push origin :dev~ pour supprimer dev mais semble sans effet
       - ~git fetch --all --prune~ suffirait √† lui seul et a supprim√© deux branches

*** emacs et WikiJS
    - modifier les fichiers du d√©p√¥t local /home/pdedieu/wiki/data/repo
      avec le user *wiki*
    - En cas de conflit entre les version locales et gitlab, emacs est
      en mode *smerge* et des raccourcis int√©ressants sont pr√©vix√©s par
      *C-c^*
      - n :: diff√©rence suivante
      - p :: diff√©rence pr√©c√©dente
      - RETURN :: valide la version sur laquelle se trouve le curseur
    - il est alors possible de sauver une version sans conflit et de
      suivre les conseils fournis par *git status* (commandes git
      manuelles multiples !)
    - Ces manipulations sont complexes et militent en faveur d'une
      √©dition sur le container en web !!

* org-mode
** Notes
   Voir *C-h i* puis *m* org[fn:2] pour lire info sur org-mode[fn:1] ou un
   article de LJ[fn:3]. Pour ins√©rer des notes voir [fn:4]
   - M-m :: place le curseur au premier caract√®re hors indentation
   - C-c C-t :: pour circuler entre les modes d'un titre (Normal -
		Todo - Done...)
   - C-c C-q :: sur un *titre*, permet de lui assigner des TAGS, par
		exemple le responsable de l'action
   - C-c / r :: Retourne le buffer avec mise en √©vidence d'une regexp
		(qu'on parcours par *M-g n* ou *p*)
   - C-c C-c ::
     - Sur une case √† cocher, permet de cocher/d√©cocher
     - Sur un titre c'est aussi les TAGS
   - C-u C-c C-c :: Tansforme un item de liste en ajoutant une case √† cocher (bascule)
   - Enrichissements :: Entourer des mots par des caract√®res / * _ ~ +
	les affiche respectivement /italics/ *bold* _underline_ ~verbatim~
	+strike-through+ Pour les cacher lors de l'√©diton, penser √†:
	=(setq org-hide-emphasis-markers t)= sachant que la valeur par
	d√©faut est =nil= mais le changement n'est pris en compte qu'√† la
	relecture du buffer (revert-buffer par exemple).
	Verbatim permet d'afficher les caract√®res d'enrichissement au lieu de les interpr√©ter.
   - Affichage des Titre avec Bullets ::
     - Installer le package *org-bullets*
     - Ajouter dans *init.el*
       #+begin_src elisp
	 (use-package org-bullets
	   :config
	   (add-hook 'org-mode-hook (lambda () (org-bullets-mode 1))))
       #+end_src
   - Tab :: pour d√©velopper / compacter un sous arbre
   - Shift-Tab :: idem mais pour tous les titres
   - Shift-droite/gauche :: Sur un titre change √©tat TODO, sur un item
	de liste permet num√©rotation...
   - Esc-Ret :: ins√®re un item de m√™me niveau que le courant... ou une
		d√©finition (idem *Alt-* Ret*)
   - Esc-Up :: d√©cale un item vers le haut (*Down* vers le bas)
   - Esc-Right :: indente d'un niveau (*Left* d√©sindente) - La r√©gion si
		  s√©lection existe
   - C-c C-n :: Titre suivant
   - C-c C-p :: Titre pr√©c√©dent
   - C-j :: Passe √† la ligne suivante en maintenant l'indentation pr√©c√©dente.
     + Noter qu'une ligne commen√ßant par un *tiret* est une liste, et qu'un
       espace entour√© de crochets carr√©s est une case √† cocher: ~[ ]~.
     + On peut la cocher / d√©cocher via *C-c C-c*.
     + On peut ins√©rer une nouvelle entr√©e de checkbox avec *S-M Return*
     + Un *%* plac√© entre crochets remplac√© par le pourcentage
       d'avancement des cases √† cocher: ~[%]~. Si c'est un ~[/]~ c'est la fraction

       Noter que si on veut une liste num√©rot√©e, commencer par ~1.~ et
       la num√©rotation se mettra √† jour toute seule (de m√™me en
       ins√©rant des lignes...mais pas en en supprimant).
   - C-c - :: Sur une ligne de liste, fait changer le type de liste
	      successivement - + 1. 1)
   - C-c x f :: pour ins√©rer une note de bas de page (footnote). Noter
	le retour apr√®s saisie via *C-c &*
   - M-q :: formate le paragraphe selon auto-fill (largeur d√©finie par
	    *C-x f*). Raccourci alternatif: *Esc-q*
   - M-% :: remplace une cha√Æne par une autre avec confirmation. Avec *C-u*
	    ce sont des regexp. Si on ne veut pas de confirmation il
	    faut *M-x replace-string*.
   - C-M-% :: remplace une regexp, en interactif (avec confirmation
              pour chaque ou tous ...).
              Exemple ~\(\w+\(_\w+\)+\)~ par ~~*\1*~~
   - M-x replace-regexp :: pour le faire sans aucune confirmation
	      entoure tous mots contenant des *_* avec des ***
     - y :: remplace la premi√®re occurence et se place sur la suivante
     - , :: remplace la premi√®re occurence et reste sur place pour voir
     - ! :: remplace toutes les occurences restantes
     - ? :: affiche et documente toutes les commandes possibles
   - <e TAB :: insertion d'un bloc pr√©format√©, donc pas interpr√©t√© par org
	       Ceci a disparu de org 9.2, si pas d√©tect√© essayer *C-c C-,* puis *e* ou *s*
	       pire ensuite qui oblige √† utiliser *M-x org-insert-structure-template*
   - <s TAB :: template pour ins√©rer une s√©quence de source dans le
	       texte (pr√©voir de pr√©ciser le langage √† la fin de la
	       ligne initiale g√©n√©r√©e). Du type #+BEGIN_SRC. C'est la
	       notion plus g√©n√©rale de squelette... voir l'aide via
	       *C-h v org-structure-template-alist*	      
   - Noter qu'on peut choisir d'ajouter ce qui est export√© en source,
     et/ou en r√©sultat avec le mot clef *:exports* suivi d'un *results* ou
     *both*. On peut aussi utiliser *:file* pour sp√©cifier un fichier de
     sortie.  Il est aussi possible de contr√¥ler le r√©sultat export√©
     - :result output :: affiche la sortie standard (celle des print ou des echo)
     - :result scalar :: affiche la valeur de retour du script

     Par d√©faut une confirmation est demand√©e avant
     ex√©cution, sauf si on ajoute soit ([[https://orgmode.org/manual/Evaluating-Code-Blocks.html#index-eval_002c-header-argument][doc org]] et [[https://org-babel.readthedocs.io/en/latest/header-args/?q=%3Aeval&check_keywords=yes&area=default#eval][doc readthedocs]])
   - org-confirm-babel-evaluate ::  est *nil*
   - :eval yes ::  dans la ligne du begin (en fait, pris en compte que
     si org-confirm-babel-evaluate est nil ! mais c'est alors la
     valeur par d√©faut. On peut au contraire ajouter un *eval: query*
     pour un bloc plus dangeureux)
   - #+PROPERTY:  :eval query :: au d√©but du fichier, √©ventuellement √†
     valider par un *C-c C-c* (ne marche pas, √† creuser)

     Plac√© dans un tel bloc de code, *C-c C-c* affiche le r√©sultat dans
     un bloc RESULT. Mais il faut une section dans le .emacs du type
     (on peut aussi mettre nil au lieu de t pour d√©sactiver un langage)
     #+BEGIN_SRC elisp
       ;; active Babel languages
       (org-babel-do-load-languages
	'org-babel-load-languages
	'((shell . t)
	  (python . t)
	  (sqlite . t)
	  (emacs-lisp . t)
	  ))
       #+END_SRC

   - C-c $ :: archive le sous arbre courant (le d√©place dans le fichier
	      d'archive, cr√©√© s'il n'existe pas).

** Insertion de lien
    - C-c C-l :: ins√®re un lien vers une URL ou un fichier, commencer par *file:* et finir par
     - ::ligne :: num√©ro de la ligne dans le fichier (pour le fichier
		  courant F:::ligne ou File:::/regex/)
     - ::/regex/ :: positionn√© sur la premi√®re occurrence de
		    l'expression r√©guli√®re (avec la liste des
		    matchs). Exemple avec [[file:~/CloudStation/Org/TODO-sur-portable.org::/lien%20cr%C3%A9%C3%A9%20selon/][ceci]]. Si l'expression est
		    trouv√©e en plusieurs endroits il sont tous
		    affich√©s en surlign√©s. On passe alors d'un match √†
		    l'autre via *M-g n* ou *M-g p* (next/previous)
   - C-c C-o :: ouvre un tel lien (dans un autre buffer)
   - C-c l :: enregistre la position actuelle dans un fichier pour
     l'utiliser dans un prochain lien. Lors de la saisie de l'URL,
     utiliser *fl√®che haut* pour le r√©cup√©rer.  Noter que dans les
     derni√®res versions le raccourci ne fonctionne plus mais on peut
     appeler la fonction *org-store-link*
   - C-u C-c C-l :: ins√®re un lien vers un fichier (permet d'utiliser
		    l'autocompl√©tion)
		    Noter aussi que c'est √©quivalent √† *C-c C-l file Enter*

** Navigation dans les titres
    - C-c C-n :: Next, prochain titre (*p* pour pr√©c√©dent)
    - C-c C-f :: Forward, prochain titre de m√™me niveau (*b* backward)
    - C-c C-u :: Up, titre de niveau sup√©rieur
    - C-c C-j :: Jump, permet de faire une recherche dans une copie du
		 fichier courant (avec les titres d√©velopp√©s au mini
		 par rapport √† la position courante) avant se
		 repositionner dans le buffer d'origine. Noter qu'on
		 peut retourner au point courant avec *C-c &*

** Saisies agenda
   - Le format des stamps peut √™tre customis√©/francis√© en changeant deux
     variables
     #+BEGIN_SRC emacs-lisp
       '(org-display-custom-times t)
       '(org-time-stamp-custom-formats (quote ("<%a %d/%m/%y>" . "<%a %d/%m/%y %H:%M>")))
     #+END_SRC
   - La liste de mes fichiers √† prendre en compte pour l'agenda est
      #+BEGIN_SRC emacs-lisp
	(setq org-agenda-files
	      '("~/CloudStation/Org/Contacts.org"
		"~/CloudStation/Org/Projets.org"
		"~/CloudStation/Org/Procedures.org"
		"~/CloudStation/Org/todo-2024.org"
		"~/CloudStation/Org/todo-2024.org_org"))
      #+END_SRC

   - C-c . :: choix d'une date (*Shift Rigth/Left/Up/Down* pour
	      d√©placer la date). en pr√©c√©dent par *C-u* on ins√®re date
	      et heure courante. Noter le d√©palcement dans le
	      calendrier propos√© par *S-right* et *S-left*.
	      On peut aussi mettre un d√©lai relatif avec
	      +45m +2h +1d +2w +1M +5y
	      (45minutes 2heures 1jour 2wemaines 1mois 5ans)
	      ou 3 lettres d'un jour de la semaine en anglais
   - C-u C-c . :: ins√®re la date et heure courante
     - Noter que *C-c .* permet de modifier un time stamp et d'y ajouter
       un HH:MM voir si n√©cessaire un HH:MM-HH:MM pour un intervalle,
       qui peut aussi se noter HH:MM+NN:XX
       enfin un intervalle de dates s√©par√©es par --
   - C-c C-d :: choix d'une deadline
   - C-c C-s :: choix d'un schedule. En plus de se d√©placer, on peut
		taper NN pour aller √† la date NN du mois courant, ou
		+1m pour aller √† dans 1 mois (ou d jour, w semaine) En
		compl√©ment, on peut faire des r√©p√©titions (en ajoutant
		un +1m pour mensuel), plus -5d pour faire un warning 5
		jours avant. Noter qu'un *C-c t* ne fait le todo que
		pour l'occurence actuelle.

   - C-c / d :: pour rechercher des dates de *deadlines* selon type,
		keyword, ...  en pr√©fixant via *C-n* on recherche les
		date jusqu'√† Today+n
   - C-c / a :: pour une recherche des dates *after* une date
   - C-c a L :: Liste les dates du buffer courant
   - C-c a :: Le menu des diff√©rentes synth√®se de dates du fichier courant
     - v :: permet de changer de vue (mensuelle, annuelle par exemple)
     - b/f :: de voir la p√©riode pr√©c√©dente / suivante
   - C-c [ :: marque le fichier courant comme √©tant √† prendre en compte
     	      comme un fichier √† analyser pour les agendas (pour la session en cours))
   - C-c / :: Sparce tree - highlight matches. Pr√©c√©d√© d'un *C-u* on
	      ajoute les matchs √† ceux de la recherche pr√©c√©dente. La
	      suppression de tout match se fait par *C-c C-c*.
     - r :: Regexp - pour surligner les matchs. On peut ensuite se
	    placer sur le match suivant avec *Alt-g n* ou *p* pour
	    pr√©c√©dent

** Affichage des agendas
   Ajout√© le <2017-04-23 dim. 14:01>
   - C-c a :: pr√©fixe des commandes de l'*agenda*. Attention suppose
	      l'activation dans le fichier init soit:
	      ~(global-set-key "\C-ca" 'org-agenda)~
     - t :: liste tous les todo du fichier
     - a :: agenda pour la semaine courante
     - n :: agenda pour la semaine courante et autres TODO (moins urgents)
   - g :: reconstruit l'affichage suite √† des modifs des fichiers d'origine
   - s :: sauve tous les buffers d'origine suite √† modif sur agenda
   - TAB :: pour afficher la date dans son contexte
   - f :: forward, affiche la p√©riode suiante (week, month...), pr√©c√©dente avec *b*
   - j :: pour choisir la date de la vue choisie
   - v :: permet de choisir d'autres affichages que la semaine
     - m :: pour un mois
     - e :: Permet d'afficher dans l'agenda le texte des entr√©es
   - C-c C-t :: Permet de changer de TODO en DONE ou Std. Noter que si
	      l'entr√©e est r√©p√©t√©e, cela schedule la prochaine
	      occurence.

** Chronom√©trage
   - C-c C-x C-i :: (in) D√©marre le chronom√©trage du temps sur une t√¢che
   - C-c C-x C-o :: (out) Arr√™te le chronom√©trage du temps sur une t√¢che
   - C-c C-x C-d :: (display) Affiche le cumul du temps de chaque t√¢che

** org-roam
    -Voir [[file:../Org/org-roam/20201226174008-org_roam_memento.org][Org-Roam-Memento]] d√©couvert le [[file:../Org/org-roam/daily/2020-12-26.org][2020-12-26]]
   - M-x org-roam-insert :: pour inserer un lien vers une note
     existante ou nouvelle (ex: retour au [[file:20201226160626-debut.org][home]] qui est aussi la page
     [[file:20201226160626-debut.org][debut]])
   - M-x org-roam :: pour afficher les backlinks de la note en cours
   - M-x org-roam-graph :: pour g√©n√©rer avec graphwiz et dans le navigateur les liens entre les notes.
   - M-x org-roam-dailies-find-date :: pour ouvrir les notes d'une journ√©e (today par defaut)
   - C-c C-O :: ouverture du lien
   - C-c C-l :: √©dition du lien (destination puis libell√©)
   - Raccourcis clavier sugg√©r√©s :: Mais pb au d√©marrage
     #+BEGIN_SRC elisp
       (define-key org-mode-map (kbd "C-c c") 'org-capture)
       ;;(define-key org-mode-map (kbd "C-c r") 'org-roam-insert) BUG, faire avec M-x
       (define-key org-mode-map (kbd "C-c t") 'org-roam-dailies-find-today)
       (define-key org-mode-map (kbd "<f12>") 'org-roam)    
     #+END_SRC
     Du coup en raccourcis globaux
     #+BEGIN_SRC elisp
       (global-set-key "\C-ct" 'org-roam-dailies-find-today) ; roam to today's note
       ;;(global-set-key "\C-ci" 'org-roam-insert) ; cr√©ation de sous note
       (global-set-key "\C-cx" 'org-roam) ; roam display links to page toggle
     #+END_SRC
   - Compl√©ter avec des recherches via l'agenda org-mode *C-c as*

** org-capture
    - org-capture :: Capture, √† partir d'un des templates d√©finis dans la
      variable *org-capture-template*
      #+BEGIN_EXAMPLE
       (org-capture-templates
	 (quote
	   (("m" "Contact mail" item
	     (file "~/CloudStation/Org/Contacts.org")
	     "%^{Type de contact|Perso|Rouen|Famille} %T %i %?" :prepend t)
	   ("t" "T√¢che" entry
	     (file "~/CloudStation/Org/Engagements.org")
	     "* TODO %i\\n  SCHEDULED: %^t\\n  %?" :prepend t)
	   ("p" "Proc√©dure par date" entry
	   (file+olp "~/CloudStation/Org/Procedures.org" "Vrac")
	   "%i")
	 ("j" "ProJets" entry
	   (file+olp "~/CloudStation/Org/Projets.org" "Liste")
	   "%i%?" :prepend t))))
      #+END_EXAMPLE

** Tableaux
*** D√©parts
     - C-u M-! :: pour r√©cup√©rer le r√©sultat d'une commande shell 
     - C-c | :: transformer la r√©gion s√©lectionn√©e en tableau via la
		  conversion auto (champs s√©par√© par des comma, ou TAB
		  ou espaces)

*** Saisies
     Un exemple de tableau (juste pour v√©rifier), pour le taper il suffit:

    - de commencer par ~|-+~ et de taper *TAB*.
    - de taper les diff√©rents titres s√©par√©s par des ~|~
    - apr√®s un *C-j* taper les diff√©rentes cases et les s√©parer par des *TAB*
    - noter que la largeur est adapt√©e automatiquement pour pouvoir
      contenir le contenu le plus large.

    - C-c - :: pour ins√©rer une ligne horizontale de s√©paration
    - C-c * :: permet de recalculer la ligne courante. (C-u pour toutes
	       les formules)
    - C-c C-c :: sur la ligne TBLFM permet de recalculer les formules
    - C-c = :: pour permettre d'ins√©rer une formule, les cases sont
	       not√©e genre par ~@2$3~ pour la deuxi√®me ligne, troisi√®me
	       case. Une zone par *@1$1..@4$5*
    - S-Enter :: compl√®te la case en dessous en incr√©mentant valeur la
		 courante
    - <NN> :: dans une case signifie qu'on veut une largeur de NN caract√®res
    - <c> :: center, centre la colonne
    - <l> :: left, aligne la colonne √† gauche

*** Manipulation lignes et colonnes
     - M-Down :: d√©place la ligne vers le bas (Up, vers le haut)
     - M-Right :: d√©place la colonne vers la droite (*Left*, vers la gauche)
     - C-c ^ :: Trie les lignes selon la colonne courante, saisir le
		type de tri (en majuscule pour un tri inverse). Noter
		que le tri s'arr√™te √† la premi√®re s√©paration
		horizontale.
       - a :: Alphab√©tique
       - n :: Num√©rique
       - t :: Time
     - S-M-Left :: supprime la colonne courante
     - S-M-Right :: Ins√®re une colonne avant la courante
     - M-x org-export-table :: permet d'exporter la tableau en cours dans un csv

*** Formules
     Les formules sont de type alg√©brique. Pour faire du elisp il faut
     les commencer par *'*

     Commencer par ~=~ pour une formule qui
     s'applique √† toute la colonne, par ~:=~ pour une seule case.

     Pour recalculer la case courante *C-c C-c* (tout le tableau si
     plac√© sur la ligne des formules)

     Les cases de la ligne courante sont *$1* √† *$n si besoin de pr√©ciser
     la ligne *@m$n*. L'avant derni√®re ligne peut se noter *@-1*.

     Deux notations possibles pour les cases, soit *A1* et *C5* pour @1$1 et @5$3

     Pour pr√©ciser un format l'ajouter apr√®s la formule, ~;%.1f %%~
     pour afficher un pourcentage √† 0.1 pr√®s.

     Pour calculer sur des dur√©e on peut pr√©ciser le format √† la fin
     de la formule, exemple ~:=vsum(@2..@-1);T~

     - C-c + :: Permet de faire la somme des cases de la colonne au dessus
     - sum :: pour la somme d'une r√©gion ???
     - vsum :: pour la somme du vecteur
     - vmean :: pour la moyenne du vecteur
     - C-c ? :: permet d'afficher dans mini buffer les noms de la case
		du curseur
     - C-c ' :: pour √©diter dans un buffer sp√©cial l'ensemble des
		formules de la table. Noter que les r√©f√©rences des
		cellules sont mis en sur-brillance dans le buffer normal
		de la table. Sortie par *C-c C-c* (abort par *C-c q*)
		*S-Left/Right/Up/Down* permet de s√©lectionner une ref !
     - C-c } :: permet d'afficher les lettres et chiffres des cases du
		tableau
     - C-c { :: permet de passer en debug (bascule). Ouvre un buffer
		avec les √©tapes du calcul de la formule

       |---------+----------------+-------+-----------------------------|
       |   <c>   |                |  <c>  |                             |
       | Pr√©nom  | Surnom         |  Age  | Commentaire                 |
       |---------+----------------+-------+-----------------------------|
       |   Moi   | Me             |  56   | NA                          |
       |   Toi   | mon toi        |  54   | pas utile de pr√©ciser       |
       | Barbara | mon b√©b√©       |  22   | qui a pass√© son permis!     |
       |   Kro   | mon petit b√©b√© |  17   | qui pourrait devenir grande |
       |---------+----------------+-------+-----------------------------|
       |  Somme  |                |  149  | Age cumul√©                  |
       | Moyenne |                | 37.25 | Age moyen                   |
       |---------+----------------+-------+-----------------------------|
       #+TBLFM: @7$3=vsum(@3$3..@6$3)::@8$3=vmean(@3..@6)

** Pr√©sentation reveal.js
    - T√©l√©charger le tar.gz sur le [[https://github.com/hakimel/reveal.js/releases][site de ref]]
    - T√©l√©charger le package *ox-reveal*
    - Ajouter du param√©trage dans *init.el*

** Pour aller plus loin
    [[http://doc.norang.ca/org-mode.html#HowToUseThisDocument][Une config tr√®s compl√®te]]
** Org-babel et inclusion de sources
 Il faut une d√©finition dans init.el du type
 #+begin_src elisp
   (org-babel-do-load-languages
    'org-babel-load-languages
    '(
      (python . t)
      (shell . t)
      (sql . t)
      ))
 #+end_src
 
** Inclusion de requ√™tes mysql
   - Voir [[https://orgmode.org/worg//org-contrib/babel/languages/ob-doc-sql.html][r√©f√©rence]]
   - suppose le package emacs *org-sql*
   - quelques exemples
     #+name:  req-preliminaire
     #+begin_src sql :engine "mysql" :dbhost hdvdb117 :dbuser IKVadm :dbpassword laLongueurCompteBeaucoupPourSecuriser :database IKV
	      -- SHOW TABLES;
	      EXPLAIN user;
	      -- EXPLAIN archive;
     #+end_src

     #+RESULTS: req-preliminaire
     | Field      | Type        | Null | Key | Default | Extra          |
     |------------+-------------+------+-----+---------+----------------|
     | id         | int(11)     | NO   | PRI | NULL    | auto_increment |
     | name       | varchar(80) | YES  | UNI | NULL    |                |
     | login      | varchar(40) | YES  | UNI | NULL    |                |
     | email      | varchar(80) | YES  |     | NULL    |                |
     | dist       | int(11)     | YES  |     | NULL    |                |
     | gprhid     | int(11)     | YES  | MUL | NULL    |                |
     | pointageid | int(11)     | YES  | MUL | NULL    |                |
     | creation   | date        | YES  |     | NULL    |                |

     #+name: historique-primes
     #+begin_src sql :engine "mysql" :dbhost hdvdb117 :dbuser IKVadm :dbpassword laLongueurCompteBeaucoupPourSecuriser :database IKV
	       SELECT * FROM archive LIMIT 10;
     #+end_src

     #+RESULTS: historique-primes
     | id | annee | cumul_dist | cumul_trajets | nb_primes | dist_mini | dist_maxi | prime_moyenne | nb_primes_maxi | agents_actifs |
     |----+-------+------------+---------------+-----------+-----------+-----------+---------------+----------------+---------------|
     |  1 |  2019 |      69754 |          7533 |       103 |        27 |      6005 |         11235 |             28 |           103 |
     |  2 |  2020 |      83101 |          8877 |       114 |         2 |      6033 |         12280 |             37 |           117 |
     |  3 |  2021 |     110083 |         11963 |       130 |         5 |      6206 |         13655 |             55 |           127 |
     |  4 |  2022 |     109879 |         13198 |       149 |         7 |      4201 |         14593 |             70 |           147 |

   - les param√®tres peuvent √™tre d√©finis dans le fichier .org avec un
     en-t√™te du type suivant (en fait c'est une autre fa√ßon de placer
     les param√®tres, mais ils ne sont pas factoris√©s entre deux
     requ√™tes)
     #+header: :engine mysql
     #+header: :dbhost hdvdb117
     #+header: :dbuser IKVadm
     #+header: :dbpassword laLongueurCompteBeaucoupPourSecuriser
     #+header: :database IKV     
     #+name: 8-derniers-users-crees
     #+begin_src sql
     SELECT id, name, dist FROM user ORDER BY id DESC LIMIT 8;
     #+end_src

     #+RESULTS: 8-derniers-users-crees
     |  id | name               | dist |
     |-----+--------------------+------|
     | 542 | Virginie TOURNADRE | 4900 |
     | 541 | Wilfried INGER     | 1600 |
     | 540 | Armelle HAUDUC     | 2800 |
     | 539 | Sebastien FOURNIER | 3000 |
     | 538 | Laetitia DEBRAY    | 2900 |
     | 537 | Xavier CORDIER     | 3000 |
     | 536 | Jerome DUBOIS      | 7000 |
     | 535 | Aboubacar SAVANE   | 5600 |

     #+header: :engine mysql
     #+header: :dbhost hdvdb117
     #+header: :dbuser IKVadm
     #+header: :dbpassword laLongueurCompteBeaucoupPourSecuriser
     #+header: :database IKV     
     #+name: 10-plus-grandes-distances
     #+begin_src sql
     SELECT id, name, dist FROM user ORDER BY dist DESC LIMIT 15;
     #+end_src

     #+RESULTS: 10-plus-grandes-distances
     |  id | name                 |  dist |
     |-----+----------------------+-------|
     |   2 | Denis WENDLING       | 34400 |
     | 158 | Norbert TOUZET       | 30200 |
     | 434 | Sophie CORNIERE      | 21700 |
     | 425 | herve GREBOVAL       | 20600 |
     | 497 | Sebastien DUPUICH    | 20600 |
     | 532 | Amanda LYSCENCZUK    | 19300 |
     | 466 | Armelle BARETTE      | 18000 |
     | 289 | Julien DUBOIS        | 17000 |
     | 533 | Kevin BOUTEILLER     | 14100 |
     |   1 | Pierre DEDIEU        | 13550 |
     | 498 | Dominique KERVELLA   | 11000 |
     | 447 | Lionel GROULT        | 10500 |
     | 151 | Vincent DANIEL       | 10100 |
     | 510 | Thomas DASSONNEVILLE | 10000 |
     | 426 | Vincent VIALLEFOND   |  9900 |

** Inclusion de code SQLite
    - Un exemple sur la base de IKV pour du CSV en sortie dans un
      fichier et l'affichage du nb de trajets
      #+header: :dir ~/python/IKV/app
      #+header: :db ikv.db
      #+BEGIN_SRC sqlite 
	.headers on
	.mode csv
	.output ikv-trajets.csv
	SELECT date, login, user.id FROM trajet LEFT JOIN user ON trajet.userid=user.id ORDER BY login;
	.output stdout
	SELECT count(date) as nb_trajet FROM trajet LEFT JOIN user ON trajet.userid=user.id ORDER BY login;
      #+END_SRC

      #+RESULTS:
      | nb_trajet |
      |        14 |

    - Une variante avec sortie par d√©faut
      #+BEGIN_SRC sqlite :db ~/python/IKV/app/ikv.db :colnames yes :exports both
		SELECT login,count(date) FROM trajet LEFT JOIN user ON trajet.userid=user.id GROUP BY user.login;
      #+END_SRC

      #+RESULTS:
      | login     | count(date) |
      |-----------+-------------|
      | csageot   |           1 |
      | dwendling |           4 |
      | pdedieu   |           9 |

    - Contenu d'une table, avec une variable (peut-√™tre plus court ?):
      #+BEGIN_SRC sqlite :db ~/python/IKV/app/ikv.db :var nomtable="user" :colnames yes :exports both
		SELECT * FROM $nomtable;
      #+END_SRC

      #+RESULTS:
      | id | name             | login     | email              |  dist |
      |----+------------------+-----------+--------------------+-------|
      |  1 | Pierre DEDIEU    | pdedieu   | pdedieu@rouen.fr   | 13800 |
      |  2 | Denis WENDLING   | dwendling | dwendling@rouen.fr | 29000 |
      |  3 | Corine SAGEOT    | csageot   | csageot@rouen.fr   |  7000 |
      |  4 | Emmanuel HAMELET | ehamelet  | ehamelet@rouen.fr  |  8000 |

    - Une requ√™te courte
      #+BEGIN_SRC sqlite :db ~/python/IKV/app/ikv.db :colnames yes :exports both
		SELECT name, login, dist/1000.0 FROM user;
      #+END_SRC

      #+RESULTS:
      | name             | login     | dist/1000.0 |
      |------------------+-----------+-------------|
      | Pierre DEDIEU    | pdedieu   |        13.8 |
      | Denis WENDLING   | dwendling |        29.0 |
      | Corine SAGEOT    | csageot   |         7.0 |
      | Emmanuel HAMELET | ehamelet  |         8.0 |
      
** Inclusion de diagrammes Ditaa
   Voir http://ehneilsen.net/notebook/orgExamples/org-examples.html#sec-2-6

   Noter qu'il faut installer le package ditaa (par apt ou yum) ET
   faire un lien symbolique depuis le chemin o√π il est cherch√© par
   emacs.

   Lors d'un export, le message est affich√© du type
   ~org-babel-execute:ditaa: Could not find ditaa.jar at
   /usr/share/emacs/25.1/lisp/contrib/scripts/ditaa.jar~ .
	     
   Cr√©er le r√©pertoire et faire un lien symbolique vers le fichier
   ditaa.jar
	     
   Le code suivant est peut √™tre n√©cessaire:
   #+BEGIN_SRC emacs-lisp
     (org-babel-do-load-languages
      'org-babel-load-languages
      '((ditaa . t)))
     (setq org-ditaa-eps-jar-path "/usr/share/ditta/ditaa.jar")
   #+END_SRC

   Voir l'exemple suivant:
   
   #+BEGIN_SRC ditaa :file ditaa-simpleboxes.png :exports both
     +---------+
     |         |	
     | Foo     |	
     |         |	
     +----+----+---+
     |Bar |Baz     |
     |    |        |
     +----+--------+
   #+END_SRC

#+RESULTS:
[[file:ditaa-simpleboxes.png]]

   #+begin_src ditaa :file ditaa-seqboxes.png :exports both
     +------+   +-----+   +-----+   +-----+
     |{io}  |   |{d}  |   |{s}  |   |cBLU |
     | Toto +---+ Bar +---+ Baz +-=-+ Moo |
     |      |   |     |   |     |   |     |
     +------+   +-----+   +--+--+   +-----+
			     |
		/-----\      |      +------+
		|cF00 |      |      | c1AB |	
		| Goo +------+---=--+ Shoo |
		\-----/             |      |
				    +------+
   #+end_src

** Inclusion de sh√©mas UML
   Il faut installer le package *plantuml* via apt ou yum. Mais il
   semble aussi qu'il faille un *plantuml.jar* et indiquer son chemin.
	     
   Le code suivant est peut √™tre n√©cessaire:
   #+BEGIN_SRC emacs-lisp
   (org-babel-do-load-languages
    'org-babel-load-languages
     '((plantuml . t)))
    (setq org-plantuml-eps-jar-path "/usr/share/plantuml/plantuml.jar")
    #+END_SRC

    #+begin_src plantuml :file class_diagram.png :exports none
    skinparam monochrome true
    FitsHdu <|-- PrimaryHdu
    FitsHdu <|-- ExtensionHdu

    FitsHdu : header
    FitsHdu : getHeaderKeyword()

    ExtensionHdu <|-- ImageHdu
    ImageHdu : image
    ImageHdu : getPixel(row, column)

    ExtensionHdu <|-- BinaryTableHdu
    BinaryTableHdu : table
    BinaryTableHdu : getRow(row)
    BinaryTableHdu : getColumn(column)
    #+end_src
** Exportation
   Il est possible de changer le format d'exportation des stime stamp
   via la variable *org-export-date-timestamp-format* par exemple
   #+begin_src elisp
   (setq org-display-custom-times t)
   (setq org-time-stamp-custom-formats '("<%A %d/%m/%Y>" . "<%A %d/%m/%Y %H:%M>"))
   #+end_src
   Mais il faut utiliser la bascule entre std et custom par ~C-c C-x
   C-t~ soit ~(org-toggle-time-stamp-overlays)~ trouv√© le
   <2023-01-09 lun. 19:24> ou en tout cas <2023-01-09 lun.>
*** Sans pandoc
   Pour produire de la bureautique, des pdf ou des pr√©sentations √†
   partir de fichiers Org. Attention, il semble que pour le traitement
   de texte, seul l'export en docx continue de marcher, il faut pr√©voir
   dans *Customize* de changer *Org Odt Preferred Output format* en
   *docx* au lieu d'*odt*.

   Les exports ont √©t√© plusieurs fois cass√©s, et une correction magique
   a √©t√© *C-u M-x org-reload* soit *C-u C-c C-x !*. Plus radical sur
   Ubuntu: r√©-installation de *org* √† partir de melpa.

   Noter qu'il est utile de pr√©ciser la langue du document org, en
   particulier pour le titre de la table des mati√®res: ~#+LANGUAGE: fr~

   Pour ignorer un titre, lui ajouter un tag *noexport* via *C-c C-c*
   sur le titre.

   - C-c C-e E e :: Exporte en epub (n√©cessite *ox-epub* de melpa et
                    l'ajout de *epub* dans la ligne du .emacs:
		    ~(org-export-backends (quote (epub html5slide html latex odt)))~

		    J'ai plusieurs fois eu des √©checs lors des exports,
                    et il semble qu'en dernier recours, un effacement
                    des versions compil√©es des sources elisp fasse
                    surmonter cela:
		    #+begin_src bash
		    for dir in "$HOME/.emacs.d/elpa/org-"*/; do find $dir -name "*.elc" -delete; done
		    #+end_src

     - Noter les remarques de l'auteur du module sur les variables
       *obligatoires* pour un fichier org √† convertir:
       - There are some required export options that need
	  to be set. These are:
	 - UID :: a unique id of the document, otherwise known as uri,
		  may be a url
	 - DATE :: the date of the document, for valid values see
            https://www.w3.org/TR/NOTE-datetime
	 - AUTHOR :: the document author or editor, the creator in the
              EPUB spec
	 - TITLE :: the document title
       - Furthermore there are some properties which are optional:
	 - Subject :: the subject matter of the book
	 - Description :: a description of the book
	 - Publisher :: the publisher of the book
	 - License :: the rights associated with this book, the
               copyright notice and further rights may be included in
               this option.

   - C-c C-e o O :: Exporte en OpenOffice Texte et l'ouvre (sauf dans
                    une version plus r√©cente d'emacs, o√π la fonction
                    n'est plus disponible en raccourci / menu mais via
                    *Alt-x org-odt-export-to-odt* (pour le revoir il
                    faut ajouter un ~(setq
                    org-export-dispatch-use-expert-ui 1)~) Voir aussi
                    le param√©trage d√©taill√© via *M-x org-customize* et
                    l'activation de *odt* dans les exports.
   - C-c C-e h o :: pour afficher le r√©sultat d'une conversion en HTML
   - C-c C-e l o :: pour faire du Latex puis pdf ... et l'ouvrir noter
		  qu'il est int√©ressant de pr√©ciser ~#+LATEX_HEADER:
		  \usepackage[french]{babel}~ pour avoir les dates, les
		  titres francis√©s !
	       
		  Noter que la conversion en latex puis pdf
		  n√©cessite *texlive* (gros !), *texlive-latex-extra* (tr√®s
		  gros aussi !!). et la pr√©visu dans emacs *dvipng*. emacs
		  semble bien s'am√©liorer pour Tex avec *AUCTex* (pour
		  ouvrir les .tex mais je ne trouve pas qu'en faire)
		 
		  Si on veut faire du XSLT pour DocBook, il faut
                  ajouter *xsltproc*... mais l√† c'est pire que tout
                  (Erreur: ... √† analyser)
   - C-c C-e C-v ... :: idem mais n'affiche que ce qui est *visible* √† l'√©cran
       
*** Configuration de pandoc
    - Commencer par installer le paquet =apt install pandoc=
    - Installer le package MELPA =ox-pandoc=
    - Il est ensuite possible d'appeler =M-x org-pandoc-export-*= pour
      produire les diff√©rents format support√©s (j'aime html5, epub3,
      slidy pour pr√©sentation HTML, ppx, docx)
    - Les variables disponibles sont [[https://github.com/kawabata/ox-pandoc][dans le git de ox-pandoc]]
    - Pour des pdf beamer, il faut installer en plus des paquets
      texlive et perso je n'ai pas abouti
      - *texlive-pictures*
      - *texlive-plain-generic*
      - *texlive-xetex*
	- Pour identifier les paquets contenant des fichiers manquants,
	  noter qu'il peut √™tre utile d'installer *apt-file* puis de faire
	  une ~apt-file search XXX.sty~
	- Apr√®s quoi j'ai un message qui me sugg√®re de changer de
	  pdf-engine
	  ~(setq org-pandoc-options-for-beamer-pdf '((pdf-engine . "xelatex")))~
*** Suite √† disparition export odt, interface √† pandoc
    #+BEGIN_SRC elisp
      (defun convert-org-to-docx ()
	"Converti le buffer courant en MS-Office Word"
	(interactive)
	(let* ((dest (replace-regexp-in-string "\.org$" ".docx" (buffer-file-name)))
	       (cmd (format "pandoc -f org -t docx %s -o %s" (buffer-file-name) dest)))
	  (shell-command cmd)
	  (message cmd)))
      (defun convert-org-to-epub ()
	"Converti le buffer courant en epub"
	(interactive)
	(let* ((dest (replace-regexp-in-string "\.org$" ".epub" (buffer-file-name)))
	       (cmd (format "pandoc -f org -t epub %s -o %s" (buffer-file-name) dest)))
	  (shell-command cmd)
	  (message cmd)))
    #+END_SRC
** Formules math√©matiques:

\(\frac{\pi}{4} = \int_0^1{\sqrt{1-x^2}^2 dx}\) et \(U_n=\sum_{i=0}^n{ \frac{i . x_i}{1+x_i^2} }\)

Qui est obtenu par: ~\(\frac{\pi}{4} = \int_0^1{\sqrt{1-x^2}^2 dx}\)~ et ~\(U_n=\sum_{i=0}^n{ \frac{i . x_i}{1+x_i^2} }\)~

Autre essai \(\int_{-1}^{72}{\frac{1+log(x)}{x+\frac{1}{\sqrt{x}^3}}}\)
avec ~\(\int_{-1}^{72}{\frac{1+log(x)}{x+\frac{1}{\sqrt{x}^3}}}\)~

** Inclure des diagrammes
   - avec graphviz: voir http://www.tonyballantyne.com/graphs.html
   - en ligne de commande *dot -Tpng filename.dot -o outfile.ps*
     
** Produire un export Word avec un template
   One of my less enjoyable tasks is to produce a weekly status report
   following a particular look. This then gets emailed off and
   compiled with others. Unsurprisingly the format has to be Microsoft
   Word and no one ever gets the use of format styles correct.

   Editing the pro-forma always has me cursing: delete one character
   too many and fonts change, bullets appear or disappear, all the
   usual joys of Word. Emacs, and more specifically org-mode to the
   rescue. Org has had the ability to export in several formats
   (typically \latex and HTML) for quite some time but now boasts
   support for OpenDocument format too.

   So my status reports are now written using Emacs with a line
   setting ~(setq org-export-odt-styles-file ~/MonTemplate)~ to point
   at a hand handcrafted OpenDocument template file. That sorts out
   the presentation aspects of the final document. C-c C-e o exports
   my text to OpenDocument then open that in LibreOffice and save as
   Microsoft Word format. The conversion from ODT to docx format can
   be automated: ~soffice --headless --convert-to docx myfilename.~

   I wouldn't say that I actually enjoy writing my status reports now,
   but at least it's considerably less painful, I can just get on with
   writing information and not with fighting the tool.
   
* Tramp
G√©n√©ralisation de noms de fichiers pour une utillisation de ressources
sit√©es sur d'autres machine.
** ssh
Les URL sont du type ~/ssh:user@host:/repertoire/fichier~
** ftp
Les URL sont du type ~/ftp:user@host:/repertoire/fichier~
** sudo
Les URL sont du type ~/sudo:user@host:/repertoire/fichier~
Pour un fichier local en root ~/sudo::/repertoire/fichier~
Il est aussi possible de combiner avec SSH par ~/ssh:user@host|sudo:host:/repertoire/fichier~
** rclone Google Drive
   - Apr√®s une installation du pacquet de la distribution et la
     configuration d'un storage de type 18 via ~rclone config~
   -URL ~/rclone:storage:/repertoire/fichier~
** Stockage des mots de passe
- Lors des acc√®s il est propos√© de stocker dans ~/.authinfo
  Cela permet d'acc√©l√©rer la connexion, mais il faut pr√©f√©rer le Passcode
  duo, qui varie √† chaque connexion et donc est redemand√©
  (contrairement √† un simple mot de passe).Le cas de Duo sur t√©l√©phone
  pr√©sente le m√™me avantage
- Pour √©viter ce fichier pr√©sent en clair, utiliser ~/.authinfo.gpg,
  et pour qu'il soit propos√© en premier pour y ajouter les nouveaux
  MDP penser √† modifier la variable *auth-sources* pour lui retirer la
  version .authinfo (ou la placer apr√®s .authinfo.gpg)
- Pour une saisie de la passphrase sans fausses frappes (!) pr√©f√©rer
  la saisie int√©gr√©e dans emacs soit les modifications suivante
  - ajouter une ligne ~allow-loopback-entry~ dans ~~/.gnupg/gpg-agent.conf~
  - modififier la variable *epa-pinentry-mode* et choisir *'loopback*
    (j'ai choisi de le faire via *C-h v epa-pinentry-mode* puis choisir *Customize* et enfin
    *Save for future sessions)*
  - selon la version d'emacs ce peut √™tre *epa-pinentry-mode* et la
    ligne peut-√™tre ~allow-loopback-pinentry~ (voir pour des versions
    plus r√©centes de GnuPG ne plus √™tre n√©cessaire) !
  - dans une occurence suivante c'est devenu ~epg-pinentry-mode~
    
** Copie de fichiers entre deux r√©pertoires tramp dired
   - Commencer par copier le r√©pertoire de destination avec ~w~ sur la
     premi√®re ligne du r√©pertoire dired
   - Se placer sur le dired de la source et utiliser ~C~ puis ~C-y~ (ou
     ~M-y~ si pas le premier)
   - Plus pratique avec ~(setq dired-dwim-target t)~ si on a ouvert 2
     dired (un pour la source et un pour la destination) il suffit de
     taper ~C~ sur le fichier source et la destination est propos√©e par
     d√©faut (accepter par Return)
     
* Installation initiale pour Ubuntu sur HyperV
  - HyperV activ√©, vswitch externe cr√©√©, iso ubuntu desktop pr√©sent√©
  - reste fig√© apr√®s un √©cran initial encourageant (semble li√© √†
    l'utilisation non judicieuse du console mode enhanced)
  - faute de mieux j'ai utilis√© l'assistant de cr√©ation de VM Ubuntu 22.04 de Hyperv
  - Je le met en IP fixe avec ma 103.16 pr√©c√©dente qui a le droit de sortir sur internet
  - La mise √† jour vers 23.04 semble Ok, mais il faut penser √†
    agrandir le HD (13 Go par d√©faut pass√© √† 40)
  - Pour le r√©seau, en plus de d√©finir un vSwitch externe il faut
    penser √† le connecter sur la bonne interface r√©seau du PC (pour
    moi Lenovo USB)
  - J'utilise voir pour passer en mode enhanced console comme
    pr√©cis√© dans
    https://www.nakivo.com/blog/install-ubuntu-20-04-on-hyper-v-with-enhanced-session/
    en particulier cela n√©cessite une installation compl√©mentaire dans la VM Ubuntu
    - le enhanced mode permet de g√©rer le multi √©cran et le *copier-coller*
  - emacs penser √† ajouter melpa et les packages:
    - use-package
    - paredit
    - magit
    - highlight-parentheses
    - helm
    - sudo-edit
    - projectile
  - r√©cup√©rer l'essentiel de mon init.el dont
    - la conf clavier de helm
    - desktop-save-mode
  - Telecharger configurer synlology-drive-client pour mon DS216+
    - Le nom public:
    - mon login:

* Liens externes
  - Un cookbook pour faire des [[http://ehneilsen.net/notebook/orgExamples/org-examples.html][notebooks dans org]]
  - Une piste pour faire des [[http://jr0cket.co.uk/2013/10/create-html5-presentations-emacs-revealjs.html.html][exports org en pr√©sentation]] avec reveal.js
  - Voir le package elscreen et l'utilisation de plusieurs sessions,
    dont sudo et la compatibilit√© aptitude ?
  - Un PPA pour avoir un GlobalProtect avec GUI dans Ubuntu (aucun rapport ?)
    https://launchpad.net/~yuezk/+archive/ubuntu/globalprotect-openconnect
    
* Footnotes
[fn:2] La vrai documentation est √† trouver via google ??
[fn:1] Ce sujet m√©riterait un fichier d√©di√© ... voir pour le cr√©er plus tard ?
[fn:3] Si on veut relire une description en anglais:
http://www.linuxjournal.com/article/9116?page=0,2
http://emacsclub.github.io/html/org_tutorial.html
[fn:4] Le bas de page n'est pas toujours ce qu'on voudrait, Mais voir
*C-c C-x f* dans cette m√™me doc.

#  LocalWords:  incrementale cliquer
